<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.7.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><link rel=stylesheet href=/css/vendor-bundle.min.16f785cdb553c8c4431db6775122af35.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/academicons@1.9.2/css/academicons.min.css integrity="sha512-KlJCpRsLf+KKu2VQa5vmRuClRFjxc5lXO03ixZt82HZUk41+1I0bD8KBSA0fY290ayMfWYI9udIqeOWSu1/uZg==" crossorigin=anonymous media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.css integrity crossorigin=anonymous media=print onload='this.media="all"'><link rel=stylesheet href=/css/wowchemy.79e2de57e874a032ccdb98ae4331b249.css><link rel=stylesheet href=/css/libs/chroma/igor.min.css title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=/css/libs/chroma/dracula.min.css title=hl-dark media=print onload='this.media="all"' disabled><meta name=author content="BKISC"><meta name=description content="An in-depth writeup on ISITDTU CTF 2022 Finals - Slow."><link rel=alternate hreflang=en-us href=https://blog.bkisc.com/blog/fazect/isitdtu-2022-slow/><link rel=canonical href=https://blog.bkisc.com/blog/fazect/isitdtu-2022-slow/><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu606891fec664e3336fdbe668a4668404_488824_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu606891fec664e3336fdbe668a4668404_488824_180x180_fill_lanczos_center_3.png><meta name=theme-color content="#1565c0"><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@bkisc"><meta property="twitter:creator" content="@bkisc"><meta property="twitter:image" content="https://blog.bkisc.com/blog/fazect/isitdtu-2022-slow/featured.png"><meta property="og:site_name" content="BKISC Blogs"><meta property="og:url" content="https://blog.bkisc.com/blog/fazect/isitdtu-2022-slow/"><meta property="og:title" content="ISITDTU CTF 2022 Finals - Slow | BKISC Blogs"><meta property="og:description" content="An in-depth writeup on ISITDTU CTF 2022 Finals - Slow."><meta property="og:image" content="https://blog.bkisc.com/blog/fazect/isitdtu-2022-slow/featured.png"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2023-01-13T16:17:00+00:00"><meta property="article:modified_time" content="2023-01-13T15:44:54+00:00"><title>ISITDTU CTF 2022 Finals - Slow | BKISC Blogs</title><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre","flag"]}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=40a209ad7f2b9aede0004e8de94746bc><script src=/js/wowchemy-init.min.ec9d49ca50e4b80bdb08f0417a28ed84.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=Close><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search class=form-control aria-label=Search...></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><div class="page-header header--fixed"><header><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/><img src=/media/logo_huc55a0313517dd04bda48a4ace4db28bc_511389_0x70_resize_lanczos_3.png alt="BKISC Blogs"></a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/><img src=/media/logo_huc55a0313517dd04bda48a4ace4db28bc_511389_0x70_resize_lanczos_3.png alt="BKISC Blogs"></a></div><div class="navbar-collapse main-menu-item collapse justify-content-center" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/introduction><span>Introduction</span></a></li><li class=nav-item><a class=nav-link href=/post><span>News</span></a></li><li class=nav-item><a class=nav-link href=/event><span>Events</span></a></li><li class=nav-item><a class="nav-link active" href=/blog><span>Blogs</span></a></li><li class=nav-item><a class=nav-link href=/members><span>Members</span></a></li><li class=nav-item><a class=nav-link href=/contact><span>Contact</span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=Search><i class="fas fa-search" aria-hidden=true></i></a></li><li class="nav-item dropdown theme-dropdown"><a href=# class=nav-link data-toggle=dropdown aria-haspopup=true aria-label="Display preferences"><i class="fas fa-moon" aria-hidden=true></i></a><div class=dropdown-menu><a href=# class="dropdown-item js-set-theme-light"><span>Light</span></a>
<a href=# class="dropdown-item js-set-theme-dark"><span>Dark</span></a>
<a href=# class="dropdown-item js-set-theme-auto"><span>Automatic</span></a></div></li></ul></div></nav></header></div><div class=page-body><article class=article><div class="article-container pt-3"><h1>ISITDTU CTF 2022 Finals - Slow</h1><div class=article-metadata><div><span><a href=/author/fazect/>FazeCT</a></span></div><span class=article-date>Jan 13, 2023</span></div><div class="btn-links mb-3"><a class="btn btn-outline-primary btn-page-header" href=https://fazect.github.io/isitdtu2022finals-slow/ target=_blank rel=noopener>Original Post</a></div></div><div class="article-header article-container featured-image-wrapper mt-4 mb-4" style=max-width:720px;max-height:720px><div style=position:relative><img src=/blog/fazect/isitdtu-2022-slow/featured_hu6032574b585ec816fcba63bea2c4323d_126446_720x2500_fit_q75_h2_lanczos_3.webp width=720 height=720 alt class=featured-image>
<span class=article-header-caption>Image credit: <a href=https://ctftime.org/team/8241/ target=_blank rel=noopener><strong>ISITDTU</strong></a></span></div></div><div class=article-container><div class=article-style><details class="toc-inpage d-print-none" open><summary class=font-weight-bold>Table of Contents</summary><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#static-analysis>Static Analysis</a></li><li><a href=#reaching-case-14>Reaching case 14</a></li><li><a href=#reaching-case-1>Reaching case 1</a></li><li><a href=#patch-the-binary>Patch the binary</a></li><li><a href=#result>Result</a></li></ul></nav></details><h2 id=introduction>Introduction</h2><p><strong>Given binary:</strong> <a href="https://drive.google.com/file/d/1K2NjzRQadtL9CkbTINYDvrH7HRgSfDc1/view?usp=share_link" target=_blank rel=noopener>Get it here!</a></p><p><strong>Description:</strong> If you can make the program runs faster, you&rsquo;ll get the flag!</p><p><strong>Category:</strong> Reverse Engineering</p><h2 id=static-analysis>Static Analysis</h2><p>The challenge provides us with a single binary, named <strong>slow.exe</strong>. By using <strong>IDA Pro</strong> or <strong>Ghidra</strong> or any other kinds of decompiler, we will get the decompiled code.</p><p>Analyze the <strong>main</strong> function, we claim that the program initiates an array whose size is <strong>45</strong>, then modifies it through some more functions, as shown below.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>main</span><span class=p>(</span><span class=kt>int</span> <span class=n>argc</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>argv</span><span class=p>,</span> <span class=k>const</span> <span class=kt>char</span> <span class=o>**</span><span class=n>envp</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>void</span> <span class=o>*</span><span class=n>Block</span><span class=p>;</span> <span class=c1>// [esp+4h] [ebp-BCh]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v5</span><span class=p>[</span><span class=mi>45</span><span class=p>];</span> <span class=c1>// [esp+8h] [ebp-B8h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v5</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=mi>10</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v5</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=o>-</span><span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span> <span class=n>snip</span>
</span></span><span class=line><span class=cl>  <span class=n>v5</span><span class=p>[</span><span class=mi>43</span><span class=p>]</span> <span class=o>=</span> <span class=mi>14</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v5</span><span class=p>[</span><span class=mi>44</span><span class=p>]</span> <span class=o>=</span> <span class=mi>16</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>Block</span> <span class=o>=</span> <span class=p>(</span><span class=kt>void</span> <span class=o>*</span><span class=p>)</span><span class=nf>sub_401AC0</span><span class=p>(</span><span class=n>v5</span><span class=p>,</span> <span class=mi>38</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>sub_4013B0</span><span class=p>(</span><span class=n>Block</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>sub_401B40</span><span class=p>(</span><span class=n>Block</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The function <strong>sub_401AC0(v5, 38, 0)</strong> allocates dynamic memory using <strong>malloc</strong> based on <strong>v5</strong> then assigns it into variable <strong>Block</strong>. That variable is then being passed into function <strong>sub_4013B0(Block)</strong>, which will produce our flag once we have fixed it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>sub_4013B0</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=n>a1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>result</span><span class=p>;</span> <span class=c1>// eax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v2</span><span class=p>;</span> <span class=c1>// eax
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v3</span><span class=p>;</span> <span class=c1>// [esp+4h] [ebp-64h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>...</span> <span class=n>snip</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>v37</span><span class=p>;</span> <span class=c1>// [esp+64h] [ebp-4h]
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>int</span> <span class=n>v38</span><span class=p>;</span> <span class=c1>// [esp+64h] [ebp-4h]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=k>while</span> <span class=p>(</span> <span class=mi>1</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>v6</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)(</span><span class=n>a1</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span><span class=o>++</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>result</span> <span class=o>=</span> <span class=n>v6</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>switch</span> <span class=p>(</span> <span class=n>v6</span> <span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=mi>1</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=n>v22</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)(</span><span class=n>a1</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>+</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=o>--</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>v26</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)(</span><span class=n>a1</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>+</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=o>--</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>v2</span> <span class=o>=</span> <span class=nf>sub_401110</span><span class=p>(</span><span class=n>v26</span><span class=p>,</span> <span class=n>v22</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>v16</span> <span class=o>=</span> <span class=n>a1</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>+</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>a1</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>=</span> <span class=n>v16</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)(</span><span class=n>a1</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>+</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>v16</span><span class=p>)</span> <span class=o>=</span> <span class=n>v2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=mi>2</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span> <span class=n>snip</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=mi>4</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span> <span class=n>snip</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=mi>5</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span> <span class=n>snip</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=mi>6</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span> <span class=n>snip</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=mi>7</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span> <span class=n>snip</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=mi>8</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span> <span class=n>snip</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=mi>9</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span> <span class=n>snip</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=mi>10</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span> <span class=n>snip</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=mi>11</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span> <span class=n>snip</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=mi>12</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span> <span class=n>snip</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=mi>13</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span> <span class=n>snip</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=mi>14</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=n>v38</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=n>_DWORD</span> <span class=o>*</span><span class=p>)(</span><span class=n>a1</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>+</span> <span class=mi>4</span> <span class=o>*</span> <span class=n>a1</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span><span class=o>--</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>sub_401040</span><span class=p>(</span><span class=s>&#34;RESULT: %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>v38</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nf>sub_401260</span><span class=p>(</span><span class=n>v38</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>break</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=mi>15</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span> <span class=n>snip</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=mi>16</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span> <span class=n>snip</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=mi>17</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span> <span class=n>snip</span>
</span></span><span class=line><span class=cl>      <span class=k>case</span> <span class=mi>18</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=p>...</span> <span class=n>snip</span>
</span></span><span class=line><span class=cl>      <span class=k>default</span><span class=o>:</span>
</span></span><span class=line><span class=cl>        <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>It is easy to observe that only case 1 and case 14 involve calling other functions.</p><p>To be more precise, if the program reaches <strong>case 1</strong>, the function <strong>sub_401110(v26, v22)</strong> will be called, and on the other hand, if the program reaches <strong>case 14</strong>, the function <strong>sub_401260(v38)</strong> will be called. We will talk more about these two functions in the next parts of this blog.</p><h2 id=reaching-case-14>Reaching case 14</h2><p>As stated earlier, the function <strong>sub_401260(v38)</strong> will be called if the program reaches <strong>case 14</strong>, which will be the last part of our code flow.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>sub_401260</span><span class=p>(</span><span class=kt>char</span> <span class=n>a1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>char</span> <span class=n>v2</span><span class=p>[</span><span class=mi>256</span><span class=p>];</span> <span class=c1>// [esp+10h] [ebp-224h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>Buffer</span><span class=p>;</span> <span class=c1>// [esp+110h] [ebp-124h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=n>_BYTE</span> <span class=n>v4</span><span class=p>[</span><span class=mi>3</span><span class=p>];</span> <span class=c1>// [esp+111h] [ebp-123h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kt>char</span> <span class=n>v5</span><span class=p>[</span><span class=mi>32</span><span class=p>];</span> <span class=c1>// [esp+210h] [ebp-24h] BYREF
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=nf>qmemcpy</span><span class=p>(</span><span class=n>v5</span><span class=p>,</span> <span class=s>&#34;Áõ&#34;</span><span class=p>,</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>v5</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>=</span> <span class=o>-</span><span class=mi>77</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v5</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>=</span> <span class=mi>26</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>...</span> <span class=n>snip</span>
</span></span><span class=line><span class=cl>  <span class=n>v5</span><span class=p>[</span><span class=mi>28</span><span class=p>]</span> <span class=o>=</span> <span class=o>-</span><span class=mi>66</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>v5</span><span class=p>[</span><span class=mi>29</span><span class=p>]</span> <span class=o>=</span> <span class=mi>63</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nf>memset</span><span class=p>(</span><span class=n>v2</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=k>sizeof</span><span class=p>(</span><span class=n>v2</span><span class=p>));</span>
</span></span><span class=line><span class=cl>  <span class=nf>sub_401D50</span><span class=p>(</span><span class=o>&amp;</span><span class=n>Buffer</span><span class=p>,</span> <span class=s>&#34;%d&#34;</span><span class=p>,</span> <span class=mi>55</span> <span class=o>*</span> <span class=n>a1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>sub_401160</span><span class=p>(</span><span class=n>v5</span><span class=p>,</span> <span class=n>v2</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>Buffer</span><span class=p>,</span> <span class=o>&amp;</span><span class=n>v4</span><span class=p>[</span><span class=nf>strlen</span><span class=p>(</span><span class=o>&amp;</span><span class=n>Buffer</span><span class=p>)]</span> <span class=o>-</span> <span class=n>v4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>sub_401040</span><span class=p>(</span><span class=s>&#34;flag is: %s&#34;</span><span class=p>,</span> <span class=p>(</span><span class=kt>char</span><span class=p>)</span><span class=n>v2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The function receives our modified variable <strong>Block</strong>, then uses it to produce our flag.</p><h2 id=reaching-case-1>Reaching case 1</h2><p>Here is where things get interesting. Take a look at the function <strong>sub_401110(v26, v22)</strong>, we can conclude that this is why our program runs slowly. The fact that it makes our program sleeps plus it is possibly called many times throughout the process makes our executable runs without any output for a very long time.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=kr>__cdecl</span> <span class=nf>sub_401110</span><span class=p>(</span><span class=kt>int</span> <span class=n>a1</span><span class=p>,</span> <span class=kt>int</span> <span class=n>a2</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>v3</span><span class=p>;</span> <span class=c1>// [esp+0h] [ebp-4h]
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>v3</span> <span class=o>=</span> <span class=nf>sub_4010F0</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>Sleep</span><span class=p>(</span><span class=mi>1000</span> <span class=o>*</span> <span class=n>a1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nf>Sleep</span><span class=p>(</span><span class=mi>1000</span> <span class=o>*</span> <span class=n>a2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nf>sub_4010F0</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span> <span class=o>-</span> <span class=n>v3</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>The algorithm here is very simple, however this is author&rsquo;s idea to let the program sleeps for a total of <strong>(a1 + a2) seconds</strong> each time this function is called. The intended result of this function is to <strong>return a1 + a2</strong>. We will have to patch the binary to get our flag.</p><h2 id=patch-the-binary>Patch the binary</h2><p>So we know what makes our program runs slowly, it is time to fix that. Below is the decompiled assembly code of that part.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>mov     ecx, [ebp+arg_0]
</span></span><span class=line><span class=cl>mov     edx, [ecx+10h]
</span></span><span class=line><span class=cl>sub     edx, 1
</span></span><span class=line><span class=cl>mov     eax, [ebp+arg_0]
</span></span><span class=line><span class=cl>mov     [eax+10h], edx
</span></span><span class=line><span class=cl>mov     ecx, [ebp+var_10]
</span></span><span class=line><span class=cl>push    ecx
</span></span><span class=line><span class=cl>mov     edx, [ebp+var_C]
</span></span><span class=line><span class=cl>push    edx
</span></span><span class=line><span class=cl>call    sub_401110
</span></span><span class=line><span class=cl>add     esp, 8
</span></span><span class=line><span class=cl>mov     [ebp+var_58], eax
</span></span><span class=line><span class=cl>mov     eax, [ebp+arg_0]
</span></span></code></pre></div><p>Instead of calling <strong>sub_401110</strong>, we should patch the program to directly calculates <strong>ecx + edx</strong> then assigns it into <strong>eax</strong>. We find out that the opcode of <strong>call sub_401110</strong> is <strong>E8 77 FC FF FF</strong>.</p><p>Using <strong>IDA Pro</strong> integrated settings, which can be found at <strong>Options > Generals > Number of Opcode bytes (non-graph) set to a large enough number</strong>, we can view each instruction&rsquo;s opcode.</p><p>With <a href=https://github.com/Gallopsled/pwntools target=_blank rel=noopener>pwntools</a> library, we also find out the opcode for <strong>add ecx, edx</strong> and <strong>move eax, ecx</strong> is <strong>01 D1</strong> and <strong>89 C8</strong> using this script written in <strong>Python</strong> below.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>arch</span> <span class=o>=</span> <span class=s1>&#39;amd64&#39;</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>asm</span><span class=p>(</span><span class=s1>&#39;add ecx, edx&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>asm</span><span class=p>(</span><span class=s1>&#39;mov eax, ecx&#39;</span><span class=p>))</span>
</span></span></code></pre></div><p>It is now time to patch the binary. Use any hex editor of your choice to patch the binary, here I use <strong>IDA Pro</strong>&rsquo;s integrated <strong>hex view</strong> to patch the binary.</p><p>Change <strong>E8 77 FC FF FF</strong> to <strong>01 D1 89 C8 90</strong> using any hex editor of your choice (here <strong>90</strong> corresponds to the <strong>NOP</strong> instruction).</p><h2 id=result>Result</h2><p>After patching the binary, run it again to get our flag.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>fazect@LAPTOP-CQA118DI:/mnt/d/Downloads$ ./slow.exe
</span></span><span class=line><span class=cl>RESULT: 75025
</span></span><span class=line><span class=cl>flag is: Pr4ct1c3_VMc0d3_w1th_F1b0n4cc1
</span></span></code></pre></div><p>Wrap the flag with <strong>ISITDTU{}</strong>, we have our flag for the challenge: <strong>ISITDTU{Pr4ct1c3_VMc0d3_w1th_F1b0n4cc1}</strong>.</p></div><div class=article-tags><a class="badge badge-light" href=/tag/ctf/>ctf</a>
<a class="badge badge-light" href=/tag/writeup/>writeup</a>
<a class="badge badge-light" href=/tag/re/>re</a>
<a class="badge badge-light" href=/tag/isitdtu-2022/>isitdtu-2022</a></div><div class=share-box><ul class=share><li><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.bkisc.com%2Fblog%2Ffazect%2Fisitdtu-2022-slow%2F&amp;text=ISITDTU+CTF+2022+Finals+-+Slow" target=_blank rel=noopener class=share-btn-twitter aria-label=twitter><i class="fab fa-twitter"></i></a></li><li><a href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fblog.bkisc.com%2Fblog%2Ffazect%2Fisitdtu-2022-slow%2F&amp;t=ISITDTU+CTF+2022+Finals+-+Slow" target=_blank rel=noopener class=share-btn-facebook aria-label=facebook><i class="fab fa-facebook"></i></a></li><li><a href="mailto:?subject=ISITDTU%20CTF%202022%20Finals%20-%20Slow&amp;body=https%3A%2F%2Fblog.bkisc.com%2Fblog%2Ffazect%2Fisitdtu-2022-slow%2F" target=_blank rel=noopener class=share-btn-email aria-label=envelope><i class="fas fa-envelope"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fblog.bkisc.com%2Fblog%2Ffazect%2Fisitdtu-2022-slow%2F&amp;title=ISITDTU+CTF+2022+Finals+-+Slow" target=_blank rel=noopener class=share-btn-linkedin aria-label=linkedin-in><i class="fab fa-linkedin-in"></i></a></li><li><a href="whatsapp://send?text=ISITDTU+CTF+2022+Finals+-+Slow%20https%3A%2F%2Fblog.bkisc.com%2Fblog%2Ffazect%2Fisitdtu-2022-slow%2F" target=_blank rel=noopener class=share-btn-whatsapp aria-label=whatsapp><i class="fab fa-whatsapp"></i></a></li><li><a href="https://service.weibo.com/share/share.php?url=https%3A%2F%2Fblog.bkisc.com%2Fblog%2Ffazect%2Fisitdtu-2022-slow%2F&amp;title=ISITDTU+CTF+2022+Finals+-+Slow" target=_blank rel=noopener class=share-btn-weibo aria-label=weibo><i class="fab fa-weibo"></i></a></li></ul></div><div class="media author-card content-widget-hr"><a href=/author/fazect/><img class="avatar mr-3 avatar-circle" src=/author/fazect/avatar_hud20978e2ce79cef4f33eb5572feeafc8_109792_270x270_fill_lanczos_center_3.png alt=FazeCT></a><div class=media-body><h5 class=card-title><a href=/author/fazect/>FazeCT</a></h5><h6 class=card-subtitle>Reverser</h6><p class=card-text>Skill issue is one of my inner traits.</p><ul class=network-icon aria-hidden=true><li><a href=mailto:ctffazect@gmail.com><i class="fas fa-envelope"></i></a></li><li><a href=https://github.com/FazeCT target=_blank rel=noopener><i class="fab fa-github"></i></a></li><li><a href=https://fazect.github.io/ target=_blank rel=noopener><i class="fas fa-globe"></i></a></li></ul></div></div></div></article></div><div class=page-footer><div class=container><footer class=site-footer><p class="powered-by copyright-license-text">© 2023 BK Information Security Club</p><p class=powered-by>Published with <a href="https://wowchemy.com/?utm_campaign=poweredby" target=_blank rel=noopener>Wowchemy</a> — the free, <a href=https://github.com/wowchemy/wowchemy-hugo-themes target=_blank rel=noopener>open source</a> website builder that empowers creators.</p></footer></div></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script src=https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.js integrity crossorigin=anonymous></script>
<script id=search-hit-fuse-template type=text/x-template>
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script><script src=https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin=anonymous></script>
<script id=page-data type=application/json>{"use_headroom":true}</script><script src=/js/wowchemy-headroom.db4755770454eb63685f8de785c0a172.js type=module></script>
<script src=/en/js/wowchemy.min.e8ee06ba8371980ffde659871dd593b0.js></script>
<script src=/js/wowchemy-map.a26e9d2f7238ba5b868384f1c5bc6477.js type=module></script></body></html>