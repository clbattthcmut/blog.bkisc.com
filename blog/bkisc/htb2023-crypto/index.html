<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.7.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><link rel=stylesheet href=/css/vendor-bundle.min.16f785cdb553c8c4431db6775122af35.css media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/academicons@1.9.2/css/academicons.min.css integrity="sha512-KlJCpRsLf+KKu2VQa5vmRuClRFjxc5lXO03ixZt82HZUk41+1I0bD8KBSA0fY290ayMfWYI9udIqeOWSu1/uZg==" crossorigin=anonymous media=print onload='this.media="all"'><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.css integrity crossorigin=anonymous media=print onload='this.media="all"'><link rel=stylesheet href=/css/wowchemy.79e51de7c4464db8eb07f9e30f7461b3.css><link rel=stylesheet href=/css/libs/chroma/igor.min.css title=hl-light media=print onload='this.media="all"'><link rel=stylesheet href=/css/libs/chroma/dracula.min.css title=hl-dark media=print onload='this.media="all"' disabled><meta name=author content="BKISC"><meta name=description content="An in-depth writeup on Cyber Apocalypse 2023 - The Cursed Mission, Cryptography category."><link rel=alternate hreflang=en-us href=https://blog.bkisc.com/blog/bkisc/htb2023-crypto/><link rel=canonical href=https://blog.bkisc.com/blog/bkisc/htb2023-crypto/><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hu606891fec664e3336fdbe668a4668404_488824_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hu606891fec664e3336fdbe668a4668404_488824_180x180_fill_lanczos_center_3.png><meta name=theme-color content="#1565c0"><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@bkisc"><meta property="twitter:creator" content="@bkisc"><meta property="twitter:image" content="https://blog.bkisc.com/blog/bkisc/htb2023-crypto/featured.jpg"><meta property="og:site_name" content="BKISC Blogs"><meta property="og:url" content="https://blog.bkisc.com/blog/bkisc/htb2023-crypto/"><meta property="og:title" content="Cyber Apocalypse 2023: The Cursed Mission - Cryptography | BKISC Blogs"><meta property="og:description" content="An in-depth writeup on Cyber Apocalypse 2023 - The Cursed Mission, Cryptography category."><meta property="og:image" content="https://blog.bkisc.com/blog/bkisc/htb2023-crypto/featured.jpg"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2023-03-27T01:00:00+00:00"><meta property="article:modified_time" content="2023-03-27T00:00:00+00:00"><title>Cyber Apocalypse 2023: The Cursed Mission - Cryptography | BKISC Blogs</title><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0,processEnvironments:!0},options:{skipHtmlTags:["script","noscript","style","textarea","pre","flag"]}},window.addEventListener("load",e=>{document.querySelectorAll("mjx-container").forEach(function(e){e.parentElement.classList+="has-jax"})})</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class=page-wrapper data-wc-page-id=aebeb7c0a862ef7d1da8a26271ea20f7><script src=/js/wowchemy-init.min.ec9d49ca50e4b80bdb08f0417a28ed84.js></script><aside class=search-modal id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=# aria-label=Close><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search class=form-control aria-label=Search...></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><div class="page-header header--fixed"><header><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/><img src=/media/logo_huc55a0313517dd04bda48a4ace4db28bc_511389_0x70_resize_lanczos_3.png alt="BKISC Blogs"></a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/><img src=/media/logo_huc55a0313517dd04bda48a4ace4db28bc_511389_0x70_resize_lanczos_3.png alt="BKISC Blogs"></a></div><div class="navbar-collapse main-menu-item collapse justify-content-center" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/introduction><span>Introduction</span></a></li><li class=nav-item><a class=nav-link href=/post><span>News</span></a></li><li class=nav-item><a class=nav-link href=/event><span>Events</span></a></li><li class=nav-item><a class="nav-link active" href=/blog><span>Blogs</span></a></li><li class=nav-item><a class=nav-link href=/members><span>Members</span></a></li><li class=nav-item><a class=nav-link href=/contact><span>Contact</span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=Search><i class="fas fa-search" aria-hidden=true></i></a></li><li class="nav-item dropdown theme-dropdown"><a href=# class=nav-link data-toggle=dropdown aria-haspopup=true aria-label="Display preferences"><i class="fas fa-moon" aria-hidden=true></i></a><div class=dropdown-menu><a href=# class="dropdown-item js-set-theme-light"><span>Light</span></a>
<a href=# class="dropdown-item js-set-theme-dark"><span>Dark</span></a>
<a href=# class="dropdown-item js-set-theme-auto"><span>Automatic</span></a></div></li></ul></div></nav></header></div><div class=page-body><article class=article><div class="article-container pt-3"><h1>Cyber Apocalypse 2023: The Cursed Mission - Cryptography</h1><div class=article-metadata><div><span><a href=/author/onirique/>Onirique</a></span>, <span><a href=/author/fazect/>FazeCT</a></span>, <span><a href=/author/dashaus165/>dasHaus165</a></span>, <span><a href=/author/tn/>TN</a></span>, <span><a href=/author/nothing/>Nothing</a></span></div><span class=article-date>Mar 27, 2023</span></div></div><div class="article-header article-container featured-image-wrapper mt-4 mb-4" style=max-width:720px;max-height:406px><div style=position:relative><img src=/blog/bkisc/htb2023-crypto/featured_hu4c2f3180282a9c007fb72f176a24e616_189327_720x2500_fit_q75_h2_lanczos.webp width=720 height=406 alt class=featured-image>
<span class=article-header-caption>Image credit: <a href=https://www.hackthebox.com/ target=_blank rel=noopener><strong>HTB</strong></a></span></div></div><div class=article-container><div class=article-style><p><ul class=tags-list><a href=https://blog.bkisc.com/tag/ctf/>ctf</a>
<a href=https://blog.bkisc.com/tag/writeup/>writeup</a>
<a href=https://blog.bkisc.com/tag/crypto/>crypto</a>
<a href=https://blog.bkisc.com/tag/htb-2023/>htb-2023</a></ul><details class="toc-inpage d-print-none" open><summary class=font-weight-bold>Table of Contents</summary><nav id=TableOfContents><ul><li><a href=#ancient-encodings>Ancient Encodings</a></li><li><a href=#small-steps>Small StEps</a></li><li><a href=#perfect-synchronization>Perfect Synchronization</a><ul><li><a href=#problem-statement>Problem statement</a></li><li><a href=#initial-analysis>Initial Analysis</a></li><li><a href=#solution-method>Solution method</a></li><li><a href=#results>Results</a></li><li><a href=#conclusion-1>Conclusion</a></li></ul></li><li><a href=#multipage-recyclings>Multipage Recyclings</a><ul><li><a href=#problem-statement-1>Problem Statement</a></li><li><a href=#initial-analysis-1>Initial Analysis</a></li><li><a href=#solution-method-1>Solution Method</a></li><li><a href=#results-1>Results</a></li></ul></li><li><a href=#inside-the-matrix>Inside the Matrix</a><ul><li><a href=#problem-statement-2>Problem Statement</a></li><li><a href=#initial-analysis-2>Initial Analysis</a></li><li><a href=#solution-method-2>Solution Method</a></li><li><a href=#results-2>Results</a></li></ul></li><li><a href=#colliding-heritage>Colliding Heritage</a><ul><li><a href=#initial-analysis-3>Initial Analysis</a></li><li><a href=#solution>Solution</a></li></ul></li><li><a href=#elliptic-labyrinth>Elliptic Labyrinth</a><ul><li><a href=#problem-statement-3>Problem Statement</a></li><li><a href=#initial-analysis-4>Initial analysis</a></li><li><a href=#solution-method-3>Solution Method</a></li><li><a href=#results-3>Results</a></li></ul></li><li><a href=#elliptic-labyrinth-revenge>Elliptic Labyrinth Revenge</a><ul><li><a href=#problem-statement-4>Problem Statement</a></li><li><a href=#initial-analysis-5>Initial Analysis</a></li><li><a href=#implementation-and-results>Implementation and Results</a></li></ul></li><li><a href=#biased-heritage>Biased Heritage</a></li><li><a href=#converging-visions>Converging Visions</a></li><li><a href=#blokechain>Blokechain</a></li><li><a href=#original-post>Original Post</a></li></ul></nav></details></p><h2 id=ancient-encodings>Ancient Encodings</h2><ul><li><p><strong>Given file:</strong> <a href="https://drive.google.com/file/d/1eDi7M0cVA9-y2EPYMWehni7YQpq-3QN4/view?usp=sharing" target=_blank rel=noopener>Get it here!</a></p></li><li><p><strong>Description:</strong> Your initialization sequence requires loading various programs to gain the necessary knowledge and skills for your journey. Your first task is to learn the ancient encodings used by the aliens in their communication.</p></li><li><p><strong>Category:</strong> Cryptography</p></li><li><p><strong>Difficulty:</strong> Very Easy</p></li></ul><p>We are given a Python script and a text file. Analyze the script, we get to know how the string is being encoded, which is <code>Base 64 encode > Conversion to long from bytes > Hex</code>.</p><p>To get the original string, we simply reverse the process, using <a href=https://gchq.github.io/CyberChef target=_blank rel=noopener>CyberChef</a> with the hex given in the text file.</p><img src=crypto1.png alt=linux width=1000><p>Flag is: <strong>HTB{1n_y0ur_j0urn3y_y0u_wi1l_se3_th15_enc0d1ngs_ev3rywher3}</strong></p><h2 id=small-steps>Small StEps</h2><ul><li><p><strong>Given file:</strong> <a href="https://drive.google.com/file/d/1UWVtdIr8GX9C6to-uuyEJe0v3Zg_baDf/view?usp=sharing" target=_blank rel=noopener>Get it here!</a></p></li><li><p><strong>Description:</strong> As you continue your journey, you must learn about the encryption method the aliens used to secure their communication from eavesdroppers. The engineering team has designed a challenge that emulates the exact parameters of the aliens&rsquo; encryption system, complete with instructions and a code snippet to connect to a mock alien server. Your task is to break it.</p></li><li><p><strong>Note:</strong> This challenge had a docker but it might be closed at the time you are reading this. All needed files will be given in the write-ups.</p></li><li><p><strong>Category:</strong> Cryptography</p></li><li><p><strong>Difficulty:</strong> Very Easy</p></li></ul><p>We are given two Python script. The server.py is to setup a server for <code>RSA encryption</code>. It will output <code>n, e, ct</code> upon connecting to the netcat server/run the Python script locally.</p><img src=crypto2.png alt=linux width=1000><p>Since <code>e</code> is always <code>3</code>, we can use <a href=https://crypto.stackexchange.com/questions/6713/low-public-exponent-attack-for-rsa target=_blank rel=noopener>Low public exponent RSA attack</a> to recover the initial message. In general, we only have to calculate <code>cube root</code> of ciphertext to get the plaintext.</p><p>Below is the implementation of the attack in Python.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>long_to_bytes</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>gmpy2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>n</span> <span class=o>=</span> <span class=mi>884883504927573976507811885368533220992278181011115684591381528075201937106582650631361008463165895850991665645858432026935373136174833729634068491453157</span>
</span></span><span class=line><span class=cl><span class=n>e</span> <span class=o>=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>ct</span> <span class=o>=</span> <span class=mi>70407336670535933819674104208890254240063781538460394662998902860952366439176467447947737680952277637330523818962104685553250402512989897886053</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>pt</span> <span class=o>=</span> <span class=n>gmpy2</span><span class=o>.</span><span class=n>iroot</span><span class=p>(</span><span class=n>ct</span><span class=p>,</span> <span class=mi>3</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>  <span class=c1># Get cube root of ct</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>long_to_bytes</span><span class=p>(</span><span class=n>pt</span><span class=p>))</span>
</span></span></code></pre></div><p>Flag is: <strong>HTB{5ma1l_E-xp0n3nt}</strong></p><h2 id=perfect-synchronization>Perfect Synchronization</h2><ul><li><p><strong>Given file:</strong> <a href="https://drive.google.com/drive/folders/1vm-yF-YzL-l18Rf83RwPo2ar0ZjLEehg?usp=sharing" target=_blank rel=noopener>Get it here!</a></p></li><li><p><strong>Description:</strong> The final stage of your initialization sequence is mastering cutting-edge technology tools that can be life-changing. One of these tools is quipqiup, an automated tool for frequency analysis and breaking substitution ciphers. This is the ultimate challenge, simulating the use of AES encryption to protect a message. Can you break it?</p></li><li><p><strong>Category:</strong> Cryptography</p></li><li><p><strong>Difficulty:</strong> Easy</p></li></ul><p>The encryption is shown below:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>os</span> <span class=kn>import</span> <span class=n>urandom</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>secret</span> <span class=kn>import</span> <span class=n>MESSAGE</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>assert</span> <span class=nb>all</span><span class=p>([</span><span class=n>x</span><span class=o>.</span><span class=n>isupper</span><span class=p>()</span> <span class=ow>or</span> <span class=n>x</span> <span class=ow>in</span> <span class=s1>&#39;</span><span class=si>{_}</span><span class=s1> &#39;</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>MESSAGE</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Cipher</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>salt</span> <span class=o>=</span> <span class=n>urandom</span><span class=p>(</span><span class=mi>15</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>key</span> <span class=o>=</span> <span class=n>urandom</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_ECB</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>encrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>c</span><span class=o>.</span><span class=n>encode</span><span class=p>()</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>salt</span><span class=p>)</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>message</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>Cipher</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypted</span> <span class=o>=</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>MESSAGE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>encrypted</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=n>c</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>encrypted</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;output.txt&#34;</span><span class=p>,</span> <span class=s1>&#39;w+&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>encrypted</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></div><h3 id=problem-statement>Problem statement</h3><p>The Python script defines a <code>Cipher</code> class that generates a random salt and key, then encrypts a message using AES in ECB mode. The encrypted message is written to a file in hexadecimal format. The <code>MESSAGE</code> variable is imported from a separate file. Our mission is to recover the encrypted message and find the flag in it.</p><h3 id=initial-analysis>Initial Analysis</h3><h4 id=the-randomness>The randomness</h4><p>The author adds some randomnesses including <code>key</code> and <code>salt</code> to make the encryption more unpredictable. But if you look more closely into it, you will realize that the <code>salt</code> is just initialized once, and be padded for all characters in the message. It means the <code>salt</code> is not too much useful, it just shifts all characters by a constant value.</p><h4 id=the-aes-encryption-mode>The AES encryption mode</h4><p>The author uses EBC mode - the weakest mode, to encrypt all <code>shifted</code> characters of the message.</p><p>For anyone who doesn&rsquo;t know about <code>ECB</code>: <code>ECB (Electronic Codebook)</code> is one of the simplest modes of <code>AES encryption</code>, where each block of plaintext is encrypted separately using the same key.</p><p>In this mode, identical plaintext blocks will be encrypted to identical ciphertext blocks, making it vulnerable to attacks that exploit patterns in the plaintext. Therefore, ECB mode is not recommended for secure communication, and other modes like CBC, CTR, or GCM are preferred. A visualized example is illustrated in <a href=https://en.wikipedia.org/wiki/Block_cipher_mode_of_operation target=_blank rel=noopener>this wiki</a> to show that AES-ECB mode is not semantically secure.</p><h4 id=conclusion>Conclusion</h4><p>By the above analysis, we can prove that:</p><p>For every $c_A, c_B \in \text{message}$: $c_A = c_B \Leftrightarrow ECB(c_A + \text{salt}) = ECB(c_B + \text{salt})$</p><p>This means the encryption is just a substitution cipher.</p><h3 id=solution-method>Solution method</h3><p>For simplicity in frequency analyzing, I map every different hex strings in the output file to a character (A-Z, 1-4), noted that identical strings would produce identical characters. By comparing to English Letter Frequency (including space character) table, we may recover some common letters like e, t, i, a, o confidentally. Then, by the reduncancy and meaning of English words, I can recover the entire content and find the flag.</p><h3 id=results>Results</h3><p>After the mapping, here is the encrypted message:</p><p><code>ABCDECFGHIJFJKHLMLIMLINJLCOIPFIQRCIAJGQIQRJQIMFIJFHISMTCFILQBCQGRIPAIVBMQQCFIKJFSEJSCIGCBQJMFIKCQQCBLIJFOIGPUNMFJQMPFLIPAIKCQQCBLIPGGEBIVMQRITJBHMFSIABCDECFGMCLIUPBCPTCBIQRCBCIMLIJIGRJBJGQCBMLQMGIOMLQBMNEQMPFIPAIKCQQCBLIQRJQIMLIBPESRKHIQRCILJUCIAPBIJKUPLQIJKKILJUWKCLIPAIQRJQIKJFSEJSCIMFIGBHWQJFJKHLMLIABCDECFGHIJFJKHLMLIJKLPIXFPVFIJLIGPEFQMFSIKCQQCBLIMLIQRCILQEOHIPAIQRCIABCDECFGHIPAIKCQQCBLIPBISBPEWLIPAIKCQQCBLIMFIJIGMWRCBQCYQIQRCIUCQRPOIMLIELCOIJLIJFIJMOIQPINBCJXMFSIGKJLLMGJKIGMWRCBLIABCDECFGHIJFJKHLMLIBCDEMBCLIPFKHIJINJLMGIEFOCBLQJFOMFSIPAIQRCILQJQMLQMGLIPAIQRCIWKJMFQCYQIKJFSEJSCIJFOILPUCIWBPNKCUILPKTMFSILXMKKLIJFOIMAIWCBAPBUCOINHIRJFOIQPKCBJFGCIAPBICYQCFLMTCIKCQQCBINPPXXCCWMFSIOEBMFSIVPBKOIVJBIMMINPQRIQRCINBMQMLRIJFOIQRCIJUCBMGJFLIBCGBEMQCOIGPOCNBCJXCBLINHIWKJGMFSIGBPLLVPBOIWEZZKCLIMFIUJ1PBIFCVLWJWCBLIJFOIBEFFMFSIGPFQCLQLIAPBIVRPIGPEKOILPKTCIQRCUIQRCIAJLQCLQILCTCBJKIPAIQRCIGMWRCBLIELCOINHIQRCIJYMLIWPVCBLIVCBCINBCJXJNKCIELMFSIABCDECFGHIJFJKHLMLIAPBICYJUWKCILPUCIPAIQRCIGPFLEKJBIGMWRCBLIELCOINHIQRCI1JWJFCLCIUCGRJFMGJKIUCQRPOLIPAIKCQQCBIGPEFQMFSIJFOILQJQMLQMGJKIJFJKHLMLISCFCBJKKHIRQN2J3LMUWKC3LENLQMQEQMPF3ML3VCJX4IGJBOIQHWCIUJGRMFCBHIVCBCIAMBLQIELCOIMFIVPBKOIVJBIMMIWPLLMNKHINHIQRCIELIJBUHLILMLIQPOJHIQRCIRJBOIVPBXIPAIKCQQCBIGPEFQMFSIJFOIJFJKHLMLIRJLINCCFIBCWKJGCOINHIGPUWEQCBILPAQVJBCIVRMGRIGJFIGJBBHIPEQILEGRIJFJKHLMLIMFILCGPFOLIVMQRIUPOCBFIGPUWEQMFSIWPVCBIGKJLLMGJKIGMWRCBLIJBCIEFKMXCKHIQPIWBPTMOCIJFHIBCJKIWBPQCGQMPFIAPBIGPFAMOCFQMJKIOJQJIWEZZKCIWEZZKCIWEZZKC</code></p><p>Plotting the histogram of this encrypted message, comparing with the expected frequency, we get:</p><img src=histogram.png alt=Histogram width=1000><p>Here is the script, if you&rsquo;re interested in:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>matplotlib.pyplot</span> <span class=k>as</span> <span class=nn>plt</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>plot_histogram</span><span class=p>(</span><span class=n>text</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>english_freq</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;space&#39;</span><span class=p>:</span> <span class=mf>0.18316895740067898</span><span class=p>,</span> <span class=s1>&#39;e&#39;</span><span class=p>:</span> <span class=mf>0.10266650309881365</span><span class=p>,</span> <span class=s1>&#39;t&#39;</span><span class=p>:</span> <span class=mf>0.07516918822929543</span><span class=p>,</span> <span class=s1>&#39;a&#39;</span><span class=p>:</span> <span class=mf>0.0653211522431101</span><span class=p>,</span> <span class=s1>&#39;o&#39;</span><span class=p>:</span> <span class=mf>0.06165021261170107</span><span class=p>,</span> <span class=s1>&#39;i&#39;</span><span class=p>:</span> <span class=mf>0.06109938076429621</span><span class=p>,</span> <span class=s1>&#39;n&#39;</span><span class=p>:</span> <span class=mf>0.05748993391266301</span><span class=p>,</span> <span class=s1>&#39;s&#39;</span><span class=p>:</span> <span class=mf>0.0558094607431706</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>:</span> <span class=mf>0.05501226388301501</span><span class=p>,</span> <span class=s1>&#39;h&#39;</span><span class=p>:</span> <span class=mf>0.0418265243918537</span><span class=p>,</span> <span class=s1>&#39;l&#39;</span><span class=p>:</span> <span class=mf>0.03203162615518401</span><span class=p>,</span> <span class=s1>&#39;d&#39;</span><span class=p>:</span> <span class=mf>0.03123691335535358</span><span class=p>,</span> <span class=s1>&#39;u&#39;</span><span class=p>:</span> <span class=mf>0.02074798285524714</span><span class=p>,</span> <span class=s1>&#39;c&#39;</span><span class=p>:</span> <span class=mf>0.020576050425919314</span><span class=p>,</span> <span class=s1>&#39;m&#39;</span><span class=p>:</span> <span class=mf>0.019830666456506605</span><span class=p>,</span> <span class=s1>&#39;f&#39;</span><span class=p>:</span> <span class=mf>0.016535714836861396</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>:</span> <span class=mf>0.015818636195592536</span><span class=p>,</span> <span class=s1>&#39;g&#39;</span><span class=p>:</span> <span class=mf>0.014126275726274115</span><span class=p>,</span> <span class=s1>&#39;p&#39;</span><span class=p>:</span> <span class=mf>0.01318902368984632</span><span class=p>,</span> <span class=s1>&#39;y&#39;</span><span class=p>:</span> <span class=mf>0.012614330285168858</span><span class=p>,</span> <span class=s1>&#39;b&#39;</span><span class=p>:</span> <span class=mf>0.010748157780246267</span><span class=p>,</span> <span class=s1>&#39;v&#39;</span><span class=p>:</span> <span class=mf>0.007961080746834234</span><span class=p>,</span> <span class=s1>&#39;k&#39;</span><span class=p>:</span> <span class=mf>0.005609987561400249</span><span class=p>,</span> <span class=s1>&#39;x&#39;</span><span class=p>:</span> <span class=mf>0.0012367402118007968</span><span class=p>,</span> <span class=s1>&#39;j&#39;</span><span class=p>:</span> <span class=mf>0.0010975645567653538</span><span class=p>,</span> <span class=s1>&#39;q&#39;</span><span class=p>:</span> <span class=mf>0.0010065039671926798</span><span class=p>,</span> <span class=s1>&#39;z&#39;</span><span class=p>:</span> <span class=mf>0.0005273232293542625</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>char_dict</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>char_dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>char_dict</span><span class=p>[</span><span class=n>char</span><span class=p>]</span> <span class=o>+=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>char_dict</span><span class=p>[</span><span class=n>char</span><span class=p>]</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>key</span> <span class=ow>in</span> <span class=n>char_dict</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>char_dict</span><span class=p>[</span><span class=n>key</span><span class=p>]</span> <span class=o>/=</span> <span class=nb>len</span><span class=p>(</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># char_dict[key] *= 100</span>
</span></span><span class=line><span class=cl>    <span class=n>char_dict</span> <span class=o>=</span> <span class=nb>dict</span><span class=p>(</span><span class=nb>sorted</span><span class=p>(</span><span class=n>char_dict</span><span class=o>.</span><span class=n>items</span><span class=p>(),</span> <span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>reverse</span><span class=o>=</span><span class=kc>True</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=c1># plt.bar(char_dict.keys(), char_dict.values())</span>
</span></span><span class=line><span class=cl>    <span class=n>fig</span><span class=p>,</span> <span class=p>(</span><span class=n>ax1</span><span class=p>,</span> <span class=n>ax2</span><span class=p>)</span> <span class=o>=</span> <span class=n>plt</span><span class=o>.</span><span class=n>subplots</span><span class=p>(</span><span class=n>nrows</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>ncols</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Plot the first subplot</span>
</span></span><span class=line><span class=cl>    <span class=n>ax1</span><span class=o>.</span><span class=n>bar</span><span class=p>(</span><span class=n>char_dict</span><span class=o>.</span><span class=n>keys</span><span class=p>(),</span> <span class=n>char_dict</span><span class=o>.</span><span class=n>values</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>ax1</span><span class=o>.</span><span class=n>set_xlabel</span><span class=p>(</span><span class=s1>&#39;Encrypted message&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ax1</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=s1>&#39;Frequency (%)&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Plot the second subplot</span>
</span></span><span class=line><span class=cl>    <span class=n>ax2</span><span class=o>.</span><span class=n>bar</span><span class=p>(</span><span class=n>english_freq</span><span class=o>.</span><span class=n>keys</span><span class=p>(),</span> <span class=n>english_freq</span><span class=o>.</span><span class=n>values</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>ax2</span><span class=o>.</span><span class=n>set_xlabel</span><span class=p>(</span><span class=s1>&#39;English&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ax2</span><span class=o>.</span><span class=n>set_ylabel</span><span class=p>(</span><span class=s1>&#39;Frequency (%)&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plt</span><span class=o>.</span><span class=n>show</span><span class=p>()</span>
</span></span></code></pre></div><p>Based on the charts, we can easily find that letter <code>I</code>, <code>C</code> in encrypted message must be <code>space</code> and <code>e</code> in English, respectively. I guess there must be one and only one pair <code>{}</code> in the message for the flag <code>HTB{...}</code>. In the above chart, letter <code>2</code> and <code>4</code> share the smallest frequency, so they must be <code>{</code> and <code>}</code>. Moreover, the 3 characters immediately preceding <code>{</code> must be <code>htb</code>. After that, we got:</p><p><code>ABeDEeFGH JFJKHLML ML bJLeO PF the AJGt thJt MF JFH SMTeF LtBetGh PA VBMtteF KJFSEJSe GeBtJMF KetteBL JFO GPUbMFJtMPFL PA KetteBL PGGEB VMth TJBHMFS ABeDEeFGMeL UPBePTeB theBe ML J GhJBJGteBMLtMG OMLtBMbEtMPF PA KetteBL thJt ML BPEShKH the LJUe APB JKUPLt JKK LJUWKeL PA thJt KJFSEJSe MF GBHWtJFJKHLML ABeDEeFGH JFJKHLML JKLP XFPVF JL GPEFtMFS KetteBL ML the LtEOH PA the ABeDEeFGH PA KetteBL PB SBPEWL PA KetteBL MF J GMWheBteYt the UethPO ML ELeO JL JF JMO tP bBeJXMFS GKJLLMGJK GMWheBL ABeDEeFGH JFJKHLML BeDEMBeL PFKH J bJLMG EFOeBLtJFOMFS PA the LtJtMLtMGL PA the WKJMFteYt KJFSEJSe JFO LPUe WBPbKeU LPKTMFS LXMKKL JFO MA WeBAPBUeO bH hJFO tPKeBJFGe APB eYteFLMTe KetteB bPPXXeeWMFS OEBMFS VPBKO VJB MM bPth the bBMtMLh JFO the JUeBMGJFL BeGBEMteO GPOebBeJXeBL bH WKJGMFS GBPLLVPBO WEZZKeL MF UJ1PB FeVLWJWeBL JFO BEFFMFS GPFteLtL APB VhP GPEKO LPKTe theU the AJLteLt LeTeBJK PA the GMWheBL ELeO bH the JYML WPVeBL VeBe bBeJXJbKe ELMFS ABeDEeFGH JFJKHLML APB eYJUWKe LPUe PA the GPFLEKJB GMWheBL ELeO bH the 1JWJFeLe UeGhJFMGJK UethPOL PA KetteB GPEFtMFS JFO LtJtMLtMGJK JFJKHLML SeFeBJKKH htb{J3LMUWKe3LEbLtMtEtMPF3ML3VeJX} GJBO tHWe UJGhMFeBH VeBe AMBLt ELeO MF VPBKO VJB MM WPLLMbKH bH the EL JBUHL LML tPOJH the hJBO VPBX PA KetteB GPEFtMFS JFO JFJKHLML hJL beeF BeWKJGeO bH GPUWEteB LPAtVJBe VhMGh GJF GJBBH PEt LEGh JFJKHLML MF LeGPFOL VMth UPOeBF GPUWEtMFS WPVeB GKJLLMGJK GMWheBL JBe EFKMXeKH tP WBPTMOe JFH BeJK WBPteGtMPF APB GPFAMOeFtMJK OJtJ WEZZKe WEZZKe WEZZKe</code></p><p>The remaining task is to guess the words based on their meanings. Here is the result:</p><p><code>frequency analysis is based on the fact that in any giTen stretch of written language certain letters and combinations of letters occur with Tarying frequencies moreoTer there is a characteristic distribution of letters that is roughly the same for almost all samples of that language in cryptanalysis frequency analysis also tnown as counting letters is the study of the frequency of letters or groups of letters in a cipherteYt the method is used as an aid to breating classical ciphers frequency analysis requires only a basic understanding of the statistics of the plainteYt language and some problem solTing stills and if performed by hand tolerance for eYtensiTe letter bootteeping during world war ii both the british and the americans recruited codebreaters by placing crossword puZZles in ma1or newspapers and running contests for who could solTe them the fastest seTeral of the ciphers used by the aYis powers were breatable using frequency analysis for eYample some of the consular ciphers used by the 1apanese mechanical methods of letter counting and statistical analysis generally htb{a_simple_substitution_is_weat} card type machinery were first used in world war ii possibly by the us armys sis today the hard wort of letter counting and analysis has been replaced by computer software which can carry out such analysis in seconds with modern computing power classical ciphers are unlitely to proTide any real protection for confidential data puZZle puZZle puZZle</code></p><p>Flag is: <strong>HTB{a_simple_substitution_is_weat}</strong></p><h3 id=conclusion-1>Conclusion</h3><p>This challenge is just a substitution cipher, which is totally insecure against frequency analysis. The <code>random key</code>, <code>salt</code>, <code>AES-ECB</code> is just to make colors :D.</p><h2 id=multipage-recyclings>Multipage Recyclings</h2><ul><li><p><strong>Given file:</strong> <a href="https://drive.google.com/file/d/1w-n16tVbL_eG-8XOvoMPJcfAEWQwxq-5/view?usp=sharing" target=_blank rel=noopener>Get it here!</a></p></li><li><p><strong>Description:</strong> As your investigation progressed, a clue led you to a local bar where you met an undercover agent with valuable information. He spoke of a famous astronomy scientist who lived in the area and extensively studied the relic. The scientist wrote a book containing valuable insights on the relic&rsquo;s location, but encrypted it before he disappeared to keep it safe from malicious intent. The old man disclosed that the book was hidden in the scientist&rsquo;s house and revealed two phrases that the scientist rambled about before vanishing.</p></li><li><p><strong>Category:</strong> Cryptography</p></li><li><p><strong>Difficulty:</strong> Easy</p></li></ul><p>The server script is shown below:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>random</span><span class=o>,</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>FLAG</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;HTB{??????????????????????}&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CAES</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>key</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_ECB</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>blockify</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>,</span> <span class=n>size</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=n>message</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=n>size</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>message</span><span class=p>),</span> <span class=n>size</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>xor</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=sa>b</span><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=nb>bytes</span><span class=p>([</span><span class=n>_a</span> <span class=o>^</span> <span class=n>_b</span><span class=p>])</span> <span class=k>for</span> <span class=n>_a</span><span class=p>,</span> <span class=n>_b</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>encrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>iv</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>plaintext</span> <span class=o>=</span> <span class=n>iv</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>blocks</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>blockify</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>block</span> <span class=ow>in</span> <span class=n>blocks</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>ct</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>encrypted_block</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>xor</span><span class=p>(</span><span class=n>block</span><span class=p>,</span> <span class=n>ct</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>ciphertext</span> <span class=o>+=</span> <span class=n>encrypted_block</span>
</span></span><span class=line><span class=cl>            <span class=n>plaintext</span> <span class=o>=</span> <span class=n>encrypted_block</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>ciphertext</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>leak</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>blocks</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=n>random</span><span class=o>.</span><span class=n>randint</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>blocks</span><span class=p>)</span> <span class=o>-</span> <span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>leak</span> <span class=o>=</span> <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>blocks</span><span class=p>[</span><span class=n>i</span><span class=p>])</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=p>[</span><span class=n>r</span><span class=p>,</span> <span class=n>r</span> <span class=o>+</span> <span class=mi>1</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>r</span><span class=p>,</span> <span class=n>leak</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>aes</span> <span class=o>=</span> <span class=n>CAES</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>message</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>FLAG</span> <span class=o>*</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span> <span class=o>=</span> <span class=n>aes</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext_blocks</span> <span class=o>=</span> <span class=n>aes</span><span class=o>.</span><span class=n>blockify</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>,</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=p>,</span> <span class=n>leak</span> <span class=o>=</span> <span class=n>aes</span><span class=o>.</span><span class=n>leak</span><span class=p>(</span><span class=n>ciphertext_blocks</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=s1>&#39;output.txt&#39;</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;ct = </span><span class=si>{</span><span class=n>ciphertext</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span><span class=si>}</span><span class=se>\n</span><span class=s1>r = </span><span class=si>{</span><span class=n>r</span><span class=si>}</span><span class=se>\n</span><span class=s1>phrases = </span><span class=si>{</span><span class=n>leak</span><span class=si>}</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></div><p>We also have an output file:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>ct</span> <span class=o>=</span> <span class=n>bc9bc77a809b7f618522d36ef7765e1cad359eef39f0eaa5dc5d85f3ab249e788c9bc36e11d72eee281d1a645027bd96a363c0e24efc6b5caa552b2df4979a5ad41e405576d415a5272ba730e27c593eb2c725031a52b7aa92df4c4e26f116c631630b5d23f11775804a688e5e4d5624</span>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>phrases</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;8b6973611d8b62941043f85cd1483244&#39;</span><span class=p>,</span> <span class=s1>&#39;cf8f71416111f1e8cdee791151c222ad&#39;</span><span class=p>]</span>
</span></span></code></pre></div><h3 id=problem-statement-1>Problem Statement</h3><p>This code defines a class called <code>CAES</code> that implements the AES encryption algorithm in ECB mode. The <code>CAES</code> class has methods to <code>blockify</code> a message into 16-byte blocks, <code>xor</code> two byte arrays, and <code>encrypt</code> a message using AES in ECB mode. Additionally, it has a method called <code>leak</code> that generates a random integer <code>r</code> and returns the encryption of two randomly chosen adjacent 16-byte blocks. The <code>main</code> function of this code creates an instance of the CAES class, generates a message by padded <code>FLAG*4</code>, encrypts the message, and generates a leak using the <code>leak</code> method of the <code>CAES</code> class. Finally, the main function writes the <code>ciphertext</code>, the randomly chosen integer <code>r</code>, and the <code>leak</code> to a file called <code>output.txt</code>.</p><h3 id=initial-analysis-1>Initial Analysis</h3><h4 id=the-encryption-method>The encryption method</h4><p>The <code>encrypt()</code> method is not in ECB mode, it&rsquo;s similar to CBC, which can be visualized by this graph:</p><img src=encryption.png alt=Encryption width=1000><h4 id=the-leaked-data>The Leaked Data</h4><p>The <code>leak</code> method extracts 2 consecutives blocks of <code>ciphertext</code> and encrypted them using ECB mode. Our leaked data is of ciphertext block 3th and 4th. By using the graph above, we can easily see where the leak data comes from and how to use it to break the system, here is the new graph:</p><img src=leak.png alt=Leak width=1000><h3 id=solution-method-1>Solution Method</h3><p>The work is simple, just to <code>xor</code> the <code>c[4]</code> with <code>Leak[0]</code> and xor <code>c[5]</code> with <code>Leak[1]</code>, then we can recover the plaintext <code>m[4]</code> and <code>m[5]</code>, respectively. They must be parts of, or entire flag (in any order).</p><p>Here is the script:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>xor</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=sa>b</span><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=nb>bytes</span><span class=p>([</span><span class=n>_a</span> <span class=o>^</span> <span class=n>_b</span><span class=p>])</span> <span class=k>for</span> <span class=n>_a</span><span class=p>,</span> <span class=n>_b</span> <span class=ow>in</span> <span class=nb>zip</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>blockify</span><span class=p>(</span><span class=n>message</span><span class=p>,</span> <span class=n>size</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=n>message</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=n>size</span><span class=p>]</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>message</span><span class=p>),</span> <span class=n>size</span><span class=p>)]</span>
</span></span><span class=line><span class=cl><span class=n>ct</span> <span class=o>=</span> <span class=s1>&#39;bc9bc77a809b7f618522d36ef7765e1cad359eef39f0eaa5dc5d85f3ab249e788c9bc36e11d72eee281d1a645027bd96a363c0e24efc6b5caa552b2df4979a5ad41e405576d415a5272ba730e27c593eb2c725031a52b7aa92df4c4e26f116c631630b5d23f11775804a688e5e4d5624&#39;</span>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl><span class=n>Leak</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;8b6973611d8b62941043f85cd1483244&#39;</span><span class=p>,</span> <span class=s1>&#39;cf8f71416111f1e8cdee791151c222ad&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>Leak</span> <span class=o>=</span> <span class=p>[</span><span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>Leak</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=n>blockify</span><span class=p>(</span><span class=n>ct</span><span class=p>,</span> <span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>c</span> <span class=o>=</span> <span class=p>[</span><span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>c</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>xor</span><span class=p>(</span><span class=n>c</span><span class=p>[</span><span class=mi>4</span><span class=p>],</span> <span class=n>Leak</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>+</span> <span class=n>xor</span><span class=p>(</span><span class=n>c</span><span class=p>[</span><span class=mi>5</span><span class=p>],</span> <span class=n>Leak</span><span class=p>[</span><span class=mi>1</span><span class=p>]))</span>
</span></span></code></pre></div><h3 id=results-1>Results</h3><p>Here is the result: <code>b'_w34k_w17h_l34kz}HTB{CFB_15_w34k'</code></p><p>Flag is: <strong>HTB{CFB_15_w34k_w34k_w17h_l34kz}</strong></p><h2 id=inside-the-matrix>Inside the Matrix</h2><ul><li><p><strong>Given file:</strong> <a href="https://drive.google.com/file/d/1w3gAAQ9VKg6HucPePcDwvUqzlKTWaRbk/view?usp=sharing" target=_blank rel=noopener>Get it here!</a></p></li><li><p><strong>Description:</strong> As you deciphered the Matrix, you discovered that the astronomy scientist had observed that certain stars were not real. He had created two 5x5 matrices with values based on the time the stars were bright, but after some time, the stars stopped emitting light. Nonetheless, he had managed to capture every matrix until then and created an algorithm that simulated their generation. However, he could not understand what was hidden behind them as he was missing something. He believed that if he could understand the stars, he would be able to locate the secret tombs where the relic was hidden.</p></li><li><p><strong>Category:</strong> Cryptography</p></li><li><p><strong>Difficulty:</strong> Easy</p></li></ul><p>The server script is shown below:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sage.all_cmdline</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=c1># from utils import ascii_print</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>FLAG</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;HTB{????????????????????}&#34;</span>
</span></span><span class=line><span class=cl><span class=k>assert</span> <span class=nb>len</span><span class=p>(</span><span class=n>FLAG</span><span class=p>)</span> <span class=o>==</span> <span class=mi>25</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Book</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>size</span> <span class=o>=</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>prime</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>parse</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>pt</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>pt</span> <span class=o>=</span> <span class=p>[</span><span class=n>b</span> <span class=k>for</span> <span class=n>b</span> <span class=ow>in</span> <span class=n>pt</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>matrix</span><span class=p>(</span><span class=n>GF</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>prime</span><span class=p>),</span> <span class=bp>self</span><span class=o>.</span><span class=n>size</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>size</span><span class=p>,</span> <span class=n>pt</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>key</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>size</span><span class=o>**</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>rotate</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>prime</span> <span class=o>=</span> <span class=n>random_prime</span><span class=p>(</span><span class=mi>2</span><span class=o>**</span><span class=mi>6</span><span class=p>,</span> <span class=kc>False</span><span class=p>,</span> <span class=mi>2</span><span class=o>**</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>encrypt</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>message</span><span class=p>:</span> <span class=nb>bytes</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>rotate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>key</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>message</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>parse</span><span class=p>(</span><span class=n>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext</span> <span class=o>=</span> <span class=n>message</span> <span class=o>*</span> <span class=n>key</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>ciphertext</span><span class=p>,</span> <span class=n>key</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>menu</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Options:</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[L]ook at page&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[T]urn page&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[C]heat</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>option</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s2>&#34;&gt; &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>option</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>book</span> <span class=o>=</span> <span class=n>Book</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>ciphertext</span><span class=p>,</span> <span class=n>key</span> <span class=o>=</span> <span class=n>book</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>FLAG</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>page_number</span> <span class=o>=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>option</span> <span class=o>=</span> <span class=n>menu</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>option</span> <span class=o>==</span> <span class=s2>&#34;L&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># ascii_print(ciphertext, key, page_number)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>page_number</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>option</span> <span class=o>==</span> <span class=s2>&#34;T&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>ciphertext</span><span class=p>,</span> <span class=n>key</span> <span class=o>=</span> <span class=n>book</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>FLAG</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>page_number</span> <span class=o>+=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>option</span> <span class=o>==</span> <span class=s2>&#34;C&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;</span><span class=se>\n</span><span class=si>{</span><span class=nb>list</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>)</span><span class=si>}</span><span class=se>\n</span><span class=si>{</span><span class=nb>list</span><span class=p>(</span><span class=n>key</span><span class=p>)</span><span class=si>}</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>Invalid option!</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>main</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;An error occurred: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=problem-statement-2>Problem Statement</h3><p>The code defines a class <code>Book</code> that is used to generate a key matrix and encrypt a message using matrix multiplication. The matrix is generated randomly each time a message is encrypted, and its size is fixed at $5\times 5$. The program encrypts a flag, stored in <code>FLAG</code>, using the <code>Book</code> class and presents a menu to the user to interact with the encrypted flag.</p><p>The main function of the code presents a menu to the user with three options:</p><ul><li><code>[L]ook at page</code>: displays the ciphertext and key matrix for the current page number. Here is an example output when you choose this option:</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Options:
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>[L]ook at page
</span></span><span class=line><span class=cl>[T]urn page
</span></span><span class=line><span class=cl>[C]heat
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&gt; L
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          _________   _________
</span></span><span class=line><span class=cl>   ______/        5\ /       6 \_______
</span></span><span class=line><span class=cl> /| --------------- |  --------------- |\
</span></span><span class=line><span class=cl>|| Ciphertext:--- - | Key:------------ |||
</span></span><span class=line><span class=cl>|| ---------------- | ------  -------- |||
</span></span><span class=line><span class=cl>|| ---------- ----- | ---------------- |||
</span></span><span class=line><span class=cl>|| [3,12,21,20,8]-- | [18,18,21,26,24] |||
</span></span><span class=line><span class=cl>|| [1,1,9,7,1]----- | [21,7,10,9,2]--- |||
</span></span><span class=line><span class=cl>|| [10,3,8,6,13]--- | [22,1,24,22,12]- |||
</span></span><span class=line><span class=cl>|| [0,19,24,15,12]- | [7,21,7,20,2]--- |||
</span></span><span class=line><span class=cl>|| [10,4,6,2,4]---- | [26,25,17,3,25]- |||
</span></span><span class=line><span class=cl>|| ---------------- | ------ ----- --- |||
</span></span><span class=line><span class=cl>|| --- - ---------- | ---------------- |||
</span></span><span class=line><span class=cl>||______________ _  |  ________________|||
</span></span><span class=line><span class=cl>L/______/---------\\_//W--------\_______\J
</span></span></code></pre></div><ul><li><p><code>[T]urn page</code>: generates a new key matrix and ciphertext for the next page number.</p></li><li><p><code>[C]heat</code>: displays the ciphertext and key matrix in list type. The Cheat output of above example page is:</p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[(3, 12, 21, 20, 8), (1, 1, 9, 7, 1), (10, 3, 8, 6, 13), (0, 19, 24, 15, 12), (10, 4, 6, 2, 4)]
</span></span><span class=line><span class=cl>[(18, 18, 21, 26, 24), (21, 7, 10, 9, 2), (22, 1, 24, 22, 12), (7, 21, 7, 20, 2), (26, 25, 17, 3, 25)]
</span></span></code></pre></div><h3 id=initial-analysis-2>Initial Analysis</h3><h4 id=primes>Primes</h4><p>Prime $p$ is changed whenever <code>Turn page</code> option is chosen. Though we don&rsquo;t know what $p$ is, we know that it would be from 16 to 64. There are 12 primes in this range, which are $17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61$.</p><h4 id=the-encryption>The Encryption</h4><p>It&rsquo;s just a multiplication between two $5 \times 5$ matrixs over the field of integers modulo $p$:</p><p>$$C \equiv M\times K (\text{mod } p)$$</p><p>$$\Leftrightarrow M \equiv C\times K^{-1} (\text{mod } p)$$</p><h4 id=conclusion-2>Conclusion</h4><p>We already have key $K$ and ciphertext $C$ by using <code>Cheat option</code>. Then if we know $p$, we can easily recover message $M$ in modulus $p$. Because $p$ is changeable, we can gather several pairs $(M_i, p_i)$ where $i \geq 2$.</p><h3 id=solution-method-2>Solution Method</h3><p>Suppose there are some entries in a key $K_1$ which are larger than 59, then $p_1$ must be 61.</p><p>Suppose all entries in a key $K_2$ are smaller than 17, then it&rsquo;s likely that $p_2$ is 17.</p><p>If we have $K_1$ and $K_2$, then we can recover $M_1$, $M_2$. By applying CRT (Chinese Remainder Theorem) for 2 pairs $(M_1, 61)$ and $(M_2, 17)$, we can get $M$ in modulus $61\times 17 = 1037$. Because every entries of the actual message&rsquo;s matrix are bytes, they would be smaller than 128 (which is much smaller than 1037). This means our $M$ is actually the message itself.</p><p>So our mission is just to find $C_1, C_2$ by using <code>Turn page</code> many times. Here is the script after we gather enough materials (I used $p_1=61$ and $p_2=19$):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>M_1</span> <span class=o>=</span> <span class=p>[</span><span class=mi>11</span><span class=p>,</span> <span class=mi>23</span><span class=p>,</span> <span class=mi>5</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>47</span><span class=p>,</span> <span class=mi>48</span><span class=p>,</span> <span class=mi>48</span><span class=p>,</span> <span class=mi>46</span><span class=p>,</span> <span class=mi>34</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>55</span><span class=p>,</span> <span class=mi>34</span><span class=p>,</span> <span class=mi>55</span><span class=p>,</span> <span class=mi>43</span><span class=p>,</span> <span class=mi>51</span><span class=p>,</span> <span class=mi>34</span><span class=p>,</span> <span class=mi>54</span><span class=p>,</span> <span class=mi>55</span><span class=p>,</span> <span class=mi>52</span><span class=p>,</span> <span class=mi>53</span><span class=p>,</span> <span class=mi>54</span><span class=p>,</span> <span class=mi>33</span><span class=p>,</span> <span class=mi>33</span><span class=p>,</span> <span class=mi>33</span><span class=p>,</span> <span class=mi>3</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>M_2</span> <span class=o>=</span> <span class=p>[</span><span class=mi>15</span><span class=p>,</span> <span class=mi>8</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>13</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>12</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>7</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>17</span><span class=p>,</span> <span class=mi>9</span><span class=p>,</span> <span class=mi>13</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>14</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span> <span class=mi>14</span><span class=p>,</span> <span class=mi>14</span><span class=p>,</span> <span class=mi>14</span><span class=p>,</span> <span class=mi>11</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>res</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sympy.ntheory.modular</span> <span class=kn>import</span> <span class=n>crt</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>M_1</span><span class=p>)):</span>  
</span></span><span class=line><span class=cl>    <span class=n>m</span> <span class=o>=</span> <span class=p>[</span><span class=mi>61</span><span class=p>,</span> <span class=mi>19</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>v</span> <span class=o>=</span> <span class=p>[</span><span class=n>M_1</span><span class=p>[</span><span class=n>i</span><span class=p>],</span> <span class=n>M_2</span><span class=p>[</span><span class=n>i</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=c1># Use crt() method </span>
</span></span><span class=line><span class=cl>    <span class=n>crt_m_v</span> <span class=o>=</span> <span class=n>crt</span><span class=p>(</span><span class=n>m</span><span class=p>,</span> <span class=n>v</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>res</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>crt_m_v</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=nb>chr</span><span class=p>(</span><span class=n>x</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>res</span><span class=p>]))</span>
</span></span></code></pre></div><h3 id=results-2>Results</h3><p>Flag is: <strong>HTB{l00k_@t_7h3_st4rs!!!}</strong></p><h2 id=colliding-heritage>Colliding Heritage</h2><ul><li><p><strong>Description:</strong> As you arrive at the location of the relic, you discover an ancient tomb that appears to have no visible entrance. However, a scan of the area reveals the presence of unusual RF signals coming from a specific location. With the help of your team, you manage to create an interface to communicate with the signal-emitting device. Unfortunately, the device only grants access to descendants of the pharaoh’s left hand. Can you find a way to enter the tomb?</p></li><li><p><strong>Category:</strong> Cryptography</p></li><li><p><strong>Difficulty:</strong> Medium</p></li></ul><p>We were given a file below:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>signal</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>secrets</span> <span class=kn>import</span> <span class=n>randbelow</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hashlib</span> <span class=kn>import</span> <span class=n>md5</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>isPrime</span><span class=p>,</span> <span class=n>getPrime</span><span class=p>,</span> <span class=n>long_to_bytes</span><span class=p>,</span> <span class=n>bytes_to_long</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>FLAG</span> <span class=o>=</span> <span class=s2>&#34;HTB{???????????????????????????}&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MD5chnorr</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># while True:</span>
</span></span><span class=line><span class=cl>        <span class=c1>#     self.q = getPrime(128)</span>
</span></span><span class=line><span class=cl>        <span class=c1>#     self.p = 2*self.q + 1</span>
</span></span><span class=line><span class=cl>        <span class=c1>#     if isPrime(self.p):</span>
</span></span><span class=line><span class=cl>        <span class=c1>#         break</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>=</span> <span class=mh>0x16dd987483c08aefa88f28147702e51eb</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>q</span> <span class=o>=</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>//</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>g</span> <span class=o>=</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>x</span> <span class=o>=</span> <span class=n>randbelow</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>q</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>y</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>g</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>x</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>H</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>msg</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>bytes_to_long</span><span class=p>(</span><span class=n>md5</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>())</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>q</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>sign</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>msg</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>k</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>H</span><span class=p>(</span><span class=n>msg</span> <span class=o>+</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>x</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;</span><span class=si>{</span><span class=n>k</span> <span class=si>= }</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>g</span><span class=p>,</span> <span class=n>k</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>q</span>
</span></span><span class=line><span class=cl>        <span class=n>e</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>H</span><span class=p>(</span><span class=n>long_to_bytes</span><span class=p>(</span><span class=n>r</span><span class=p>)</span> <span class=o>+</span> <span class=n>msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span> <span class=o>=</span> <span class=p>(</span><span class=n>k</span> <span class=o>-</span> <span class=bp>self</span><span class=o>.</span><span class=n>x</span> <span class=o>*</span> <span class=n>e</span><span class=p>)</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>q</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>verify</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>msg</span><span class=p>,</span> <span class=n>sig</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span><span class=p>,</span> <span class=n>e</span> <span class=o>=</span> <span class=n>sig</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=p>(</span><span class=mi>0</span> <span class=o>&lt;</span> <span class=n>s</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>q</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=p>(</span><span class=mi>0</span> <span class=o>&lt;</span> <span class=n>e</span> <span class=o>&lt;</span> <span class=bp>self</span><span class=o>.</span><span class=n>q</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=n>rv</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>g</span><span class=p>,</span> <span class=n>s</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span> <span class=o>*</span> <span class=nb>pow</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>y</span><span class=p>,</span> <span class=n>e</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>q</span>
</span></span><span class=line><span class=cl>        <span class=n>ev</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>H</span><span class=p>(</span><span class=n>long_to_bytes</span><span class=p>(</span><span class=n>rv</span><span class=p>)</span> <span class=o>+</span> <span class=n>msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>ev</span> <span class=o>==</span> <span class=n>e</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>menu</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;[S]ign a message&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;[V]erify a signature&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>input</span><span class=p>(</span><span class=s1>&#39;&gt; &#39;</span><span class=p>)</span><span class=o>.</span><span class=n>upper</span><span class=p>()[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>md5chnorr</span> <span class=o>=</span> <span class=n>MD5chnorr</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;g:&#39;</span><span class=p>,</span> <span class=n>md5chnorr</span><span class=o>.</span><span class=n>g</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;y:&#39;</span><span class=p>,</span> <span class=n>md5chnorr</span><span class=o>.</span><span class=n>y</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;p:&#39;</span><span class=p>,</span> <span class=n>md5chnorr</span><span class=o>.</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>_</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>choice</span> <span class=o>=</span> <span class=n>menu</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>choice</span> <span class=o>==</span> <span class=s1>&#39;S&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>msg</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=nb>input</span><span class=p>(</span><span class=s1>&#39;Enter message&gt; &#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=sa>b</span><span class=s1>&#39;I am the left hand&#39;</span> <span class=ow>in</span> <span class=n>msg</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;No!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>sig</span> <span class=o>=</span> <span class=n>md5chnorr</span><span class=o>.</span><span class=n>sign</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Signature:&#39;</span><span class=p>,</span> <span class=n>sig</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>choice</span> <span class=o>==</span> <span class=s1>&#39;V&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>msg</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=nb>input</span><span class=p>(</span><span class=s1>&#39;Enter message&gt; &#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=n>s</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>input</span><span class=p>(</span><span class=s1>&#39;Enter s&gt; &#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=n>e</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>input</span><span class=p>(</span><span class=s1>&#39;Enter e&gt; &#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>md5chnorr</span><span class=o>.</span><span class=n>verify</span><span class=p>(</span><span class=n>msg</span><span class=p>,</span> <span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>e</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>msg</span> <span class=o>==</span> <span class=sa>b</span><span class=s1>&#39;I am the left hand&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=n>FLAG</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Valid signature!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Invalid signature!&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Invalid choice...&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>signal</span><span class=o>.</span><span class=n>alarm</span><span class=p>(</span><span class=mi>30</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></div><h3 id=initial-analysis-3>Initial Analysis</h3><p>This challenge implements the <a href=https://en.wikipedia.org/wiki/Schnorr_signature target=_blank rel=noopener>Schnorr signature</a>. We were given 4 parameters including the generator $g$, prime $q,p=2*q+1$ and $y=g^{x} [pq]$. To get the flag, we have to submit to <code>verify</code> function a message with its signature such that there is a string <code>I am the left hand</code> in the message. However we can not create signature for any message that has this string via function <code>sign</code>. To solved this challenge, i create a signature by hand by retriving the private key $x$ in <code>sign</code> function.</p><h3 id=solution>Solution</h3><p>After reading on wiki, i noticed a vulnerability section <code>Key leakage from nonce reuse</code>. If we create two signatures with the same nonce $k$, then we have:</p><p>$$s_1= k-xe_1 [q]$$</p><p>$$s_2= k-xe_2 [q]$$</p><p>Now we can easily get the private key $x$:</p><p>$$x = (s_2 - s_1)(e_1e_2)^{-1}[q]$$</p><p>But how can we create two signatures with the same $k$? From the source we know that $k$ is actually <code>md5(msg|x)</code>. We can submit any $msg$ we want, so i immediately think of creating the md5 identical-prefix collision using <a href=https://github.com/cr-marcstevens/hashclash target=_blank rel=noopener>Hashclash</a>. Hashclash will help us to find 2 messages of length 64 that has the same md5 hash, therefore <code>md5(msg|x)</code> or $k$ of these messages will be the same.</p><p>After getting $x$, with any message that has the required string we can easily compute $k$ and then $r$, create our own signature $e$ and submit to server to get the flag.</p><p>Flag is: <strong>HTB{w3ll_y3s_bu7_4c7ual1y_n0…}</strong></p><h2 id=elliptic-labyrinth>Elliptic Labyrinth</h2><ul><li><p><strong>Given file:</strong> <a href="https://drive.google.com/file/d/1w4QyL7cKzhcZJ_qqakudh6fXLtj8mk6p/view?usp=sharing" target=_blank rel=noopener>Get it here!</a></p></li><li><p><strong>Description:</strong> As you navigate through the labyrinth inside the tomb, you encounter GPS inaccuracies that make it difficult to determine the correct path to the exit. Can you overcome the technical issues and use your instincts to find your way out of the maze?</p></li><li><p><strong>Note:</strong> This challenge had a docker but it might be closed at the time you are reading this. All needed files will be given in the write-ups.</p></li><li><p><strong>Category:</strong> Cryptography</p></li><li><p><strong>Difficulty:</strong> Medium</p></li></ul><p>The server script is shown below:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span><span class=o>,</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hashlib</span> <span class=kn>import</span> <span class=n>sha256</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>random</span> <span class=kn>import</span> <span class=n>randint</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>getPrime</span><span class=p>,</span> <span class=n>long_to_bytes</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sage.all_cmdline</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>secret</span> <span class=kn>import</span> <span class=n>FLAG</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ECC</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>bits</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=n>bits</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>a</span> <span class=o>=</span> <span class=n>randint</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>b</span> <span class=o>=</span> <span class=n>randint</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>gen_random_point</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>EllipticCurve</span><span class=p>(</span><span class=n>GF</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>),</span> <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>a</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>b</span><span class=p>])</span><span class=o>.</span><span class=n>random_point</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>menu</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;1. Get parameters of path&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;2. Get point in path&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;3. Try to exit the labyrinth&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>option</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s2>&#34;&gt; &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>option</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>ec</span> <span class=o>=</span> <span class=n>ECC</span><span class=p>(</span><span class=mi>512</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>choice</span> <span class=o>=</span> <span class=n>menu</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>choice</span> <span class=o>==</span> <span class=s1>&#39;1&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span> <span class=o>=</span> <span class=n>randint</span><span class=p>(</span><span class=n>ec</span><span class=o>.</span><span class=n>p</span><span class=o>.</span><span class=n>bit_length</span><span class=p>()</span> <span class=o>//</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>2</span> <span class=o>*</span> <span class=n>ec</span><span class=o>.</span><span class=n>p</span><span class=o>.</span><span class=n>bit_length</span><span class=p>()</span> <span class=o>//</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;p&#39;</span><span class=p>:</span> <span class=nb>hex</span><span class=p>(</span><span class=n>ec</span><span class=o>.</span><span class=n>p</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;a&#39;</span><span class=p>:</span> <span class=nb>hex</span><span class=p>(</span><span class=n>ec</span><span class=o>.</span><span class=n>a</span> <span class=o>&gt;&gt;</span> <span class=n>r</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;b&#39;</span><span class=p>:</span> <span class=nb>hex</span><span class=p>(</span><span class=n>ec</span><span class=o>.</span><span class=n>b</span> <span class=o>&gt;&gt;</span> <span class=n>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>}))</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>choice</span> <span class=o>==</span> <span class=s1>&#39;2&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>A</span> <span class=o>=</span> <span class=n>ec</span><span class=o>.</span><span class=n>gen_random_point</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span><span class=s1>&#39;x&#39;</span><span class=p>:</span> <span class=nb>hex</span><span class=p>(</span><span class=n>A</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span> <span class=s1>&#39;y&#39;</span><span class=p>:</span> <span class=nb>hex</span><span class=p>(</span><span class=n>A</span><span class=p>[</span><span class=mi>1</span><span class=p>])}))</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>choice</span> <span class=o>==</span> <span class=s1>&#39;3&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>iv</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>key</span> <span class=o>=</span> <span class=n>sha256</span><span class=p>(</span><span class=n>long_to_bytes</span><span class=p>(</span><span class=nb>pow</span><span class=p>(</span><span class=n>ec</span><span class=o>.</span><span class=n>a</span><span class=p>,</span> <span class=n>ec</span><span class=o>.</span><span class=n>b</span><span class=p>,</span> <span class=n>ec</span><span class=o>.</span><span class=n>p</span><span class=p>)))</span><span class=o>.</span><span class=n>digest</span><span class=p>()[:</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>flag</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>FLAG</span><span class=p>,</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;iv&#39;</span><span class=p>:</span> <span class=n>iv</span><span class=o>.</span><span class=n>hex</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;enc&#39;</span><span class=p>:</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=p>}))</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Bye.&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>exit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></div><h3 id=problem-statement-3>Problem Statement</h3><p>The program generates random secret elliptic curve parameters and allows the user to:</p><ul><li><p>Option 1: Obtain the modulus <code>p</code> and a few MSB bits of ECC parameters.</p></li><li><p>Option 2: Obtain a random point on the curve.</p></li><li><p>Option 3: Provide the encrypted FLAG.</p></li></ul><p>Our mission is to decrypt the flag.</p><h3 id=initial-analysis-4>Initial analysis</h3><h4 id=what-we-need-to-decrypt-the-flag>What we need to decrypt the flag?</h4><p>Obviously, we cannot break the AES to find the flag without the <code>key</code>. To recover the <code>key</code>, we need to know all elliptic curve&rsquo;s parameters, which are <code>a</code>, <code>b</code> and <code>p</code>. We already known <code>p</code>, so what we do is trying to retrieve <code>a</code> and <code>b</code> from the information provided by the server.</p><h4 id=having-many-points-on-the-curve>Having many points on the curve</h4><p>Every point $P(x, y)$ belonging to this elliptic curve must satisfy the equation: $y^2 \equiv x^3 + ax + b (\text{mod } p)$. To find <code>a</code> and <code>b</code> in <code>p</code>, we must at least have a system of 2 equations like this. Fortunately, the server allows user to generate many points.</p><h3 id=solution-method-3>Solution Method</h3><p>Suppose we have two different points $M(x_m, y_m)$, $N(x_n, y_n)$ in the curve. We recover $a,b$ by below formulas:</p><p>$a \equiv (y^2_m - y^2_n - (x^3_m - x^3_n))(x_m - x_n)^{-1} (\text{mod } p)$</p><p>$b \equiv y^2_m - x^3_m - ax_m (\text{mod } p)$</p><p>The script:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>recover</span><span class=p>(</span><span class=n>p</span><span class=p>,</span> <span class=n>M</span><span class=p>,</span> <span class=n>N</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>x1</span><span class=p>,</span> <span class=n>y1</span> <span class=o>=</span> <span class=n>M</span>
</span></span><span class=line><span class=cl>    <span class=n>x2</span><span class=p>,</span> <span class=n>y2</span> <span class=o>=</span> <span class=n>N</span>
</span></span><span class=line><span class=cl>    <span class=n>a</span> <span class=o>=</span> <span class=nb>pow</span><span class=p>(</span><span class=n>x1</span> <span class=o>-</span> <span class=n>x2</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span> <span class=o>*</span> <span class=p>(</span><span class=nb>pow</span><span class=p>(</span><span class=n>y1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span> <span class=o>-</span> <span class=nb>pow</span><span class=p>(</span><span class=n>y2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span> <span class=o>-</span> <span class=p>(</span><span class=nb>pow</span><span class=p>(</span><span class=n>x1</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span> <span class=o>-</span> <span class=nb>pow</span><span class=p>(</span><span class=n>x2</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=n>p</span><span class=p>)))</span> <span class=o>%</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>    <span class=n>b</span> <span class=o>=</span> <span class=p>(</span><span class=nb>pow</span><span class=p>(</span><span class=n>y1</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span> <span class=o>-</span> <span class=nb>pow</span><span class=p>(</span><span class=n>x1</span><span class=p>,</span> <span class=mi>3</span><span class=p>,</span> <span class=n>p</span><span class=p>)</span> <span class=o>-</span> <span class=n>a</span> <span class=o>*</span> <span class=n>x1</span><span class=p>)</span> <span class=o>%</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span>
</span></span></code></pre></div><p>That&rsquo;s all! By having <code>a</code> and <code>b</code>, we can easily recover the <code>key</code> and therefore decrypt the FLAG.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hashlib</span> <span class=kn>import</span> <span class=n>sha256</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>random</span> <span class=kn>import</span> <span class=n>randint</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>getPrime</span><span class=p>,</span> <span class=n>long_to_bytes</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>iv</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=n>sha256</span><span class=p>(</span><span class=n>long_to_bytes</span><span class=p>(</span><span class=nb>pow</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>)))</span><span class=o>.</span><span class=n>digest</span><span class=p>()[:</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>enc</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>enc</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>enc</span><span class=p>))</span>
</span></span></code></pre></div><h3 id=results-3>Results</h3><p>Flag is: <strong>HTB{d3fund_s4v3s_th3_d4y!}</strong></p><h2 id=elliptic-labyrinth-revenge>Elliptic Labyrinth Revenge</h2><ul><li><p><strong>Given file:</strong> <a href="https://drive.google.com/file/d/1wKzblzA6_mYWHLM-CHcUo-6NjIzX9Llc/view?usp=sharing" target=_blank rel=noopener>Get it here!</a></p></li><li><p><strong>Description:</strong> As you navigate through the labyrinth inside the tomb, you encounter GPS inaccuracies that make it difficult to determine the correct path to the exit. Can you overcome the technical issues and use your instincts to find your way out of the maze?</p></li><li><p><strong>Note:</strong> This challenge had a docker but it might be closed at the time you are reading this. All needed files will be given in the write-ups.</p></li><li><p><strong>Category:</strong> Crypto</p></li><li><p><strong>Difficulty:</strong> Hard</p></li></ul><p>This challenge is a modified version of <code>Elliptic Labyrinth</code> to force CTF players solve it in intended way.</p><p>The server script is shown below, which has a bit different from the previous version:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span><span class=o>,</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hashlib</span> <span class=kn>import</span> <span class=n>sha256</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>random</span> <span class=kn>import</span> <span class=n>randint</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>getPrime</span><span class=p>,</span> <span class=n>long_to_bytes</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sage.all_cmdline</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>secret</span> <span class=kn>import</span> <span class=n>FLAG</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ECC</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>bits</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>=</span> <span class=n>getPrime</span><span class=p>(</span><span class=n>bits</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>a</span> <span class=o>=</span> <span class=n>randint</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>b</span> <span class=o>=</span> <span class=n>randint</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>gen_random_point</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>EllipticCurve</span><span class=p>(</span><span class=n>GF</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>),</span> <span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>a</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>b</span><span class=p>])</span><span class=o>.</span><span class=n>random_point</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>menu</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;1. Get parameters of path&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;2. Try to exit the labyrinth&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>option</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s2>&#34;&gt; &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>option</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>ec</span> <span class=o>=</span> <span class=n>ECC</span><span class=p>(</span><span class=mi>512</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>A</span> <span class=o>=</span> <span class=n>ec</span><span class=o>.</span><span class=n>gen_random_point</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;This is the point you calculated before:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span><span class=s1>&#39;x&#39;</span><span class=p>:</span> <span class=nb>hex</span><span class=p>(</span><span class=n>A</span><span class=p>[</span><span class=mi>0</span><span class=p>]),</span> <span class=s1>&#39;y&#39;</span><span class=p>:</span> <span class=nb>hex</span><span class=p>(</span><span class=n>A</span><span class=p>[</span><span class=mi>1</span><span class=p>])}))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>choice</span> <span class=o>=</span> <span class=n>menu</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>choice</span> <span class=o>==</span> <span class=s1>&#39;1&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span> <span class=o>=</span> <span class=n>randint</span><span class=p>(</span><span class=n>ec</span><span class=o>.</span><span class=n>p</span><span class=o>.</span><span class=n>bit_length</span><span class=p>()</span> <span class=o>//</span> <span class=mi>3</span><span class=p>,</span> <span class=mi>2</span> <span class=o>*</span> <span class=n>ec</span><span class=o>.</span><span class=n>p</span><span class=o>.</span><span class=n>bit_length</span><span class=p>()</span> <span class=o>//</span> <span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;p&#39;</span><span class=p>:</span> <span class=nb>hex</span><span class=p>(</span><span class=n>ec</span><span class=o>.</span><span class=n>p</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;a&#39;</span><span class=p>:</span> <span class=nb>hex</span><span class=p>(</span><span class=n>ec</span><span class=o>.</span><span class=n>a</span> <span class=o>&gt;&gt;</span> <span class=n>r</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;b&#39;</span><span class=p>:</span> <span class=nb>hex</span><span class=p>(</span><span class=n>ec</span><span class=o>.</span><span class=n>b</span> <span class=o>&gt;&gt;</span> <span class=n>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=p>}))</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>choice</span> <span class=o>==</span> <span class=s1>&#39;2&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>iv</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>key</span> <span class=o>=</span> <span class=n>sha256</span><span class=p>(</span><span class=n>long_to_bytes</span><span class=p>(</span><span class=nb>pow</span><span class=p>(</span><span class=n>ec</span><span class=o>.</span><span class=n>a</span><span class=p>,</span> <span class=n>ec</span><span class=o>.</span><span class=n>b</span><span class=p>,</span> <span class=n>ec</span><span class=o>.</span><span class=n>p</span><span class=p>)))</span><span class=o>.</span><span class=n>digest</span><span class=p>()[:</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>flag</span> <span class=o>=</span> <span class=n>pad</span><span class=p>(</span><span class=n>FLAG</span><span class=p>,</span> <span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>({</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;iv&#39;</span><span class=p>:</span> <span class=n>iv</span><span class=o>.</span><span class=n>hex</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;enc&#39;</span><span class=p>:</span> <span class=n>cipher</span><span class=o>.</span><span class=n>encrypt</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span><span class=o>.</span><span class=n>hex</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=p>}))</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Bye.&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>exit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></div><h3 id=problem-statement-4>Problem Statement</h3><p>The program generates random secret elliptic curve parameters and allows the user to:</p><ul><li><p>Option 1: Obtain the modulus <code>p</code> and a few MSB bits of ECC parameters.</p></li><li><p>Option 2: Provide the encrypted <code>FLAG</code>.</p></li></ul><p>Unlike the previous one, now the server doesn&rsquo;t provide an option to generate random points, instead it gives players only one point at the beginning. The objective is to recover curve&rsquo;s parameters given a single point of the curve, <code>p</code> and the most significant bits of <code>a</code> and <code>b</code>.</p><h3 id=initial-analysis-5>Initial Analysis</h3><h4 id=aes-encryption>AES Encryption</h4><p>Easily see that the AES scheme is normal and therefore we can exploit anything from it. The only way to retrieve the <code>FLAG</code> is finding the key, which means finding the curve&rsquo;s parameters.</p><h4 id=leak-bits>Leak Bits</h4><p>For some $170 \leq r \leq 340$, let&rsquo;s define $a_{h}$ and $b_h$ as the $r$ MSB bits of $a$ and $b$, define $a_l$ and $b_l$ as the remaining bits of $a$ and $b$, respectively. By our definition, we have:</p><p>$a = a_h \times 2^r + a_l$</p><p>$b = b_h \times 2^r + b_l$</p><p>Substitute $a$ and $b$ to the Weierstrass elliptic curve equation, we get:</p><p>$y^2 \equiv x^3 + (2^ra_h + a_l)x + 2^rb_h + b_l \text{ (mod }p)$</p><p>We define a polynomial $F(\alpha, \beta)$ in $GF(p)$ satifies $F(a_l, b_l) = 0$:</p><p>$F(\alpha, \beta) = x_P\alpha + \beta + 2^r a_h \times x_P + 2^rb_h\times x_P - y^2_P$</p><p>where $(x_P, y_P)$ is the known point given by the server at beginning. When having most significant bits of a number known, a typical method to apply is Coppersmith, particularly bivariate polynomial Coppersmith in this time.</p><h3 id=implementation-and-results>Implementation and Results</h3><p>By connecting to the server, I received these information:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=mh>0xe3b0aa3465a71f45fdd6350587d041c481ae061401465aa9e089827ac0548728771f6baf095b5f44bb8410dc9709ea22df72bf635f04475fedeb24f13d488ceb</span>
</span></span><span class=line><span class=cl><span class=n>a_h</span> <span class=o>=</span> <span class=mh>0x3128114d5bdecf9388699fd05d1432d444f9e8bda4e620b13445d6f9705721d7dff1</span>
</span></span><span class=line><span class=cl><span class=n>b_h</span> <span class=o>=</span> <span class=mh>0x2cf39f8fd105112fdaa7c7144f3e7e7da15e93fa59efc32b2c185bf5151153e7fd07</span>
</span></span><span class=line><span class=cl><span class=n>x_P</span> <span class=o>=</span> <span class=mh>0x266dd3ba72bad801e16d03509ae1656b0f137c2382f40a420ff90e40f291073b46ae395f2858ccd719299d786c8191796f882daf2a55760d9c58fbcb6c5355da</span>
</span></span><span class=line><span class=cl><span class=n>y_P</span> <span class=o>=</span> <span class=mh>0x7c24c560a9bf720ff447de5671342787c762508e44a2e269ed0794e5ef33f9014f1dd53d8a3ebcb301d5fecdfde4d2413ee079b0ad8e716729c0123787d7fa4d</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>iv</span> <span class=o>=</span> <span class=s2>&#34;8ace74afe026aab8ff1288a9076141fb&#34;</span>
</span></span><span class=line><span class=cl><span class=n>enc</span> <span class=o>=</span> <span class=s2>&#34;a07c4ac6d8dc0abe11d955a79e37d8b21721704dfccf6f3938646c74b1c3374f6d0f8e71962e48c405c629533c804ea0&#34;</span>
</span></span></code></pre></div><p>The good implementation of multivariate Coppersmith I used is in <a href=https://github.com/defund/coppersmith target=_blank rel=noopener>this repo</a> of Defund:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>itertools</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>small_roots</span><span class=p>(</span><span class=n>f</span><span class=p>,</span> <span class=n>bounds</span><span class=p>,</span> <span class=n>m</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span> <span class=n>d</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=ow>not</span> <span class=n>d</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>d</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>degree</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>R</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>base_ring</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=n>N</span> <span class=o>=</span> <span class=n>R</span><span class=o>.</span><span class=n>cardinality</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=n>f</span> <span class=o>/=</span> <span class=n>f</span><span class=o>.</span><span class=n>coefficients</span><span class=p>()</span><span class=o>.</span><span class=n>pop</span><span class=p>(</span><span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=n>f</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>change_ring</span><span class=p>(</span><span class=n>ZZ</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>G</span> <span class=o>=</span> <span class=n>Sequence</span><span class=p>([],</span> <span class=n>f</span><span class=o>.</span><span class=n>parent</span><span class=p>())</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>m</span><span class=o>+</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=n>base</span> <span class=o>=</span> <span class=n>N</span><span class=o>^</span><span class=p>(</span><span class=n>m</span><span class=o>-</span><span class=n>i</span><span class=p>)</span> <span class=o>*</span> <span class=n>f</span><span class=o>^</span><span class=n>i</span>
</span></span><span class=line><span class=cl>		<span class=k>for</span> <span class=n>shifts</span> <span class=ow>in</span> <span class=n>itertools</span><span class=o>.</span><span class=n>product</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=n>d</span><span class=p>),</span> <span class=n>repeat</span><span class=o>=</span><span class=n>f</span><span class=o>.</span><span class=n>nvariables</span><span class=p>()):</span>
</span></span><span class=line><span class=cl>			<span class=n>g</span> <span class=o>=</span> <span class=n>base</span> <span class=o>*</span> <span class=n>prod</span><span class=p>(</span><span class=nb>map</span><span class=p>(</span><span class=n>power</span><span class=p>,</span> <span class=n>f</span><span class=o>.</span><span class=n>variables</span><span class=p>(),</span> <span class=n>shifts</span><span class=p>))</span>
</span></span><span class=line><span class=cl>			<span class=n>G</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>g</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>B</span><span class=p>,</span> <span class=n>monomials</span> <span class=o>=</span> <span class=n>G</span><span class=o>.</span><span class=n>coefficient_matrix</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=n>monomials</span> <span class=o>=</span> <span class=n>vector</span><span class=p>(</span><span class=n>monomials</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>factors</span> <span class=o>=</span> <span class=p>[</span><span class=n>monomial</span><span class=p>(</span><span class=o>*</span><span class=n>bounds</span><span class=p>)</span> <span class=k>for</span> <span class=n>monomial</span> <span class=ow>in</span> <span class=n>monomials</span><span class=p>]</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>factor</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>factors</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=n>B</span><span class=o>.</span><span class=n>rescale_col</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=n>factor</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>B</span> <span class=o>=</span> <span class=n>B</span><span class=o>.</span><span class=n>dense_matrix</span><span class=p>()</span><span class=o>.</span><span class=n>LLL</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>B</span> <span class=o>=</span> <span class=n>B</span><span class=o>.</span><span class=n>change_ring</span><span class=p>(</span><span class=n>QQ</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>factor</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>factors</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=n>B</span><span class=o>.</span><span class=n>rescale_col</span><span class=p>(</span><span class=n>i</span><span class=p>,</span> <span class=mi>1</span><span class=o>/</span><span class=n>factor</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>H</span> <span class=o>=</span> <span class=n>Sequence</span><span class=p>([],</span> <span class=n>f</span><span class=o>.</span><span class=n>parent</span><span class=p>()</span><span class=o>.</span><span class=n>change_ring</span><span class=p>(</span><span class=n>QQ</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=n>h</span> <span class=ow>in</span> <span class=nb>filter</span><span class=p>(</span><span class=kc>None</span><span class=p>,</span> <span class=n>B</span><span class=o>*</span><span class=n>monomials</span><span class=p>):</span>
</span></span><span class=line><span class=cl>		<span class=n>H</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>h</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>I</span> <span class=o>=</span> <span class=n>H</span><span class=o>.</span><span class=n>ideal</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=n>I</span><span class=o>.</span><span class=n>dimension</span><span class=p>()</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>H</span><span class=o>.</span><span class=n>pop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>		<span class=k>elif</span> <span class=n>I</span><span class=o>.</span><span class=n>dimension</span><span class=p>()</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>roots</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>			<span class=k>for</span> <span class=n>root</span> <span class=ow>in</span> <span class=n>I</span><span class=o>.</span><span class=n>variety</span><span class=p>(</span><span class=n>ring</span><span class=o>=</span><span class=n>ZZ</span><span class=p>):</span>
</span></span><span class=line><span class=cl>				<span class=n>root</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span><span class=n>R</span><span class=p>(</span><span class=n>root</span><span class=p>[</span><span class=n>var</span><span class=p>])</span> <span class=k>for</span> <span class=n>var</span> <span class=ow>in</span> <span class=n>f</span><span class=o>.</span><span class=n>variables</span><span class=p>())</span>
</span></span><span class=line><span class=cl>				<span class=n>roots</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>root</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=n>roots</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=nb>bin</span><span class=p>(</span><span class=n>p</span><span class=p>))</span> <span class=o>-</span> <span class=nb>len</span><span class=p>(</span><span class=nb>bin</span><span class=p>(</span><span class=n>a_h</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>Fp</span> <span class=o>=</span> <span class=n>GF</span><span class=p>(</span><span class=n>p</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>a_h</span><span class=p>,</span> <span class=n>b_h</span><span class=p>,</span> <span class=n>x_P</span><span class=p>,</span> <span class=n>y_P</span>  <span class=o>=</span> <span class=nb>map</span><span class=p>(</span><span class=n>Fp</span><span class=p>,</span> <span class=p>[</span><span class=n>a_h</span><span class=p>,</span> <span class=n>b_h</span><span class=p>,</span> <span class=n>x_P</span><span class=p>,</span> <span class=n>y_P</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=n>P</span><span class=o>.&lt;</span><span class=n>alpha</span><span class=p>,</span> <span class=n>beta</span><span class=o>&gt;</span> <span class=o>=</span> <span class=n>PolynomialRing</span><span class=p>(</span><span class=n>Fp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>F</span> <span class=o>=</span> <span class=n>x_P</span> <span class=o>*</span> <span class=n>alpha</span> <span class=o>+</span> <span class=n>beta</span> <span class=o>+</span> <span class=n>x_P</span><span class=o>^</span><span class=mi>3</span> <span class=o>+</span> <span class=mi>2</span><span class=o>^</span><span class=n>r</span> <span class=o>*</span> <span class=n>a_h</span> <span class=o>*</span> <span class=n>x_P</span> <span class=o>+</span> <span class=mi>2</span><span class=o>^</span><span class=n>r</span> <span class=o>*</span> <span class=n>b_h</span> <span class=o>-</span> <span class=n>y_P</span><span class=o>^</span><span class=mi>2</span>
</span></span><span class=line><span class=cl><span class=n>roots</span> <span class=o>=</span> <span class=n>small_roots</span><span class=p>(</span><span class=n>F</span><span class=p>,</span> <span class=p>(</span><span class=mi>2</span><span class=o>^</span><span class=n>r</span><span class=p>,</span> <span class=mi>2</span><span class=o>^</span><span class=n>r</span><span class=p>),</span> <span class=n>m</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>d</span><span class=o>=</span><span class=mi>5</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>a_l</span><span class=p>,</span> <span class=n>b_l</span> <span class=o>=</span> <span class=n>roots</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;a_l = </span><span class=si>{</span><span class=n>a_l</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;b_l = </span><span class=si>{</span><span class=n>b_l</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>The results:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>a_l</span> <span class=o>=</span> <span class=mi>4090003137759760265604501674930222345811449862978588668280246527938919495</span>
</span></span><span class=line><span class=cl><span class=n>b_l</span> <span class=o>=</span> <span class=mi>6854882327443898686047723082547152279783184053818145063785025112346556672</span>
</span></span></code></pre></div><p>After recovering <code>x_l</code> and <code>y_l</code>, I decrypted the <code>FLAG</code> by this script:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hashlib</span> <span class=kn>import</span> <span class=n>sha256</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>random</span> <span class=kn>import</span> <span class=n>randint</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=n>getPrime</span><span class=p>,</span> <span class=n>long_to_bytes</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>pad</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>a</span> <span class=o>=</span> <span class=p>(</span><span class=n>a_h</span> <span class=o>&lt;&lt;</span> <span class=mi>242</span><span class=p>)</span> <span class=o>+</span> <span class=n>a_l</span>
</span></span><span class=line><span class=cl><span class=n>b</span> <span class=o>=</span> <span class=p>(</span><span class=n>b_h</span> <span class=o>&lt;&lt;</span> <span class=mi>242</span><span class=p>)</span> <span class=o>+</span> <span class=n>b_l</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>iv</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=n>sha256</span><span class=p>(</span><span class=n>long_to_bytes</span><span class=p>(</span><span class=nb>pow</span><span class=p>(</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>p</span><span class=p>)))</span><span class=o>.</span><span class=n>digest</span><span class=p>()[:</span><span class=mi>16</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>enc</span> <span class=o>=</span> <span class=nb>bytes</span><span class=o>.</span><span class=n>fromhex</span><span class=p>(</span><span class=n>enc</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>enc</span><span class=p>))</span>
</span></span></code></pre></div><p>Flag is: <strong>HTB{y0u_5h0u1d_h4v3_u53d_c00p325m17h}</strong></p><h2 id=biased-heritage>Biased Heritage</h2><ul><li><p><strong>Given file:</strong> <a href=https://github.com/sudo-rainman/ctf_script/tree/main/htb_cyberapocalypse2023/crypto_biased_heritage target=_blank rel=noopener>Get it here!</a></p></li><li><p><strong>Description:</strong> You emerge from the labyrinth to find a massive door blocking your path to the relic. It has the same authentication mechanism as the entrance, but it appears to be more sophisticated and challenging to crack. Can you devise a plan to breach the door and gain access to the relic?</p></li><li><p><strong>Category:</strong> Cryptography</p></li><li><p><strong>Difficulty:</strong> Hard</p></li></ul><p>Compared to the last challenge (Colliding Heritage), <code>k</code> is now generated by <code>SHA256</code> insteads which is much more resilient against hash collision attacks than <code>MD5</code> or nearly impossible to do so. Because of that, our previous attack wouldn&rsquo;t work on this challenge.</p><p>After noticing the word <code>BIASED</code> in the challenge name, I had a hunch that this chall gonna need some LLL magic. Based on that, I kept looking for a small integer or atleast any repetitive parts of a number (or so called bias), and found one in the followng hashing function.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>H</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>msg</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>bytes_to_long</span><span class=p>(</span><span class=mi>2</span> <span class=o>*</span> <span class=n>sha256</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>())</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>q</span>
</span></span></code></pre></div><p>You can easily see that <code>k = 2*SHA256( msg || secret )</code>. In other words, <code>k = (2^256+1)\*x</code> where x is unknown <code>256-bit</code> output from <code>SHA256</code> function while k is <code>512-bit</code>. Bingo, LLL time.</p><p>Well, the server allows us to query for 3 times, we should use the first 2 times to collect signatures which are just enough for our use and the last ones to trick the server into giving us the flag. So we got:</p><img src=equations.png alt="Ảnh thì như này" width=1000><p>Since <code>S</code> is known <code>512-bit</code>, and <code>k</code> only has <code>256</code> unknown bits we can start constructing a lattice to solve the SVP problem with LLL now.</p><img src=matrix.png alt="Ảnh thì như này" width=1000><p>After LLL, we gonna get a short vector that look like this:</p><img src=vector.png alt="Ảnh thì như này" width=200><p>Well, that was alot. Here comes the script in Sage (I parsed signature and submitted signatures all by hands):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>hashlib</span> <span class=kn>import</span> <span class=n>sha256</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.number</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>##get 2 signature from server </span>
</span></span><span class=line><span class=cl><span class=n>sig0</span> <span class=o>=</span>  <span class=p>(</span><span class=mi>2201384718072843790141885598870601009149158537568071358193592308444053168306421929467556420242693286691490522215468964110881851509880735493338991645390396</span><span class=p>,</span> <span class=mi>2318623387388989624095214099569047825341708399431253151627450383635519224666598718188372928127571765685778247137818236688391434765968118358634695411837390</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sig1</span> <span class=o>=</span>    <span class=p>(</span><span class=mi>5643323405968098617359379045374815314162245377024975944768494215044558381083529231024356935255866448701807811319414715896126937899577482072265546826687923</span><span class=p>,</span> <span class=mi>1027133811051642261997157563892411730891386064630632377323975878292520406108099727744365069912026927564457147136857066971987676141520708801237151093219205</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>s_temp</span><span class=o>=</span> <span class=p>[</span><span class=n>sig0</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>sig1</span><span class=p>[</span><span class=mi>0</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=n>e_temp</span><span class=o>=</span> <span class=p>[</span><span class=n>sig0</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>sig1</span><span class=p>[</span><span class=mi>1</span><span class=p>]]</span>
</span></span><span class=line><span class=cl><span class=c1># q prime</span>
</span></span><span class=line><span class=cl><span class=n>q</span><span class=o>=</span> <span class=p>[</span><span class=mi>10183765261512984706477412009638081602843766654569849535936436797593873507566983996455981325952833624810053852919430991796953569087107929681393648627640673</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>preal</span> <span class=o>=</span> <span class=mh>0x184e26a581fca2893b2096528eb6103ac03f60b023e1284ebda3ab24ad9a9fe0e37b33eeecc4b3c3b9e50832fd856e9889f6c9a10cde54ee798a7c383d0d8d2c3</span>
</span></span><span class=line><span class=cl><span class=n>g</span><span class=o>=</span><span class=mi>3</span> 
</span></span><span class=line><span class=cl><span class=n>s0</span><span class=o>=</span> <span class=n>s_temp</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>*</span><span class=n>inverse</span><span class=p>(</span><span class=n>e_temp</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>q</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>%</span> <span class=n>q</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>s1</span><span class=o>=</span> <span class=n>s_temp</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>*</span><span class=n>inverse</span><span class=p>(</span><span class=n>e_temp</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=n>q</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>%</span> <span class=n>q</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>temp0</span> <span class=o>=</span> <span class=p>(</span><span class=mi>2</span><span class=o>**</span><span class=mi>256</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>inverse</span><span class=p>(</span><span class=n>e_temp</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>q</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>%</span> <span class=n>q</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>temp1</span> <span class=o>=</span> <span class=p>(</span><span class=mi>2</span><span class=o>**</span><span class=mi>256</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span><span class=o>*</span><span class=n>inverse</span><span class=p>(</span><span class=n>e_temp</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span><span class=n>q</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>%</span> <span class=n>q</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>S</span> <span class=o>=</span> <span class=p>(</span><span class=n>s0</span><span class=o>-</span><span class=n>s1</span><span class=p>)</span> <span class=o>%</span> <span class=n>q</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>m</span> <span class=o>=</span> <span class=n>Matrix</span><span class=p>([[</span><span class=mi>1</span><span class=o>/</span><span class=mi>2</span><span class=o>^</span><span class=mi>256</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=o>-</span><span class=n>temp0</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=o>/</span><span class=mi>2</span><span class=o>^</span><span class=mi>256</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>temp1</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>1</span><span class=p>,</span><span class=n>S</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=p>[</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=mi>0</span><span class=p>,</span><span class=n>q</span><span class=p>[</span><span class=mi>0</span><span class=p>]]])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>res</span> <span class=o>=</span> <span class=n>m</span><span class=o>.</span><span class=n>LLL</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>H</span><span class=p>(</span><span class=n>msg</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>bytes_to_long</span><span class=p>(</span><span class=mi>2</span> <span class=o>*</span> <span class=n>sha256</span><span class=p>(</span><span class=n>msg</span><span class=p>)</span><span class=o>.</span><span class=n>digest</span><span class=p>())</span> <span class=o>%</span> <span class=n>q</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>sign</span><span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>msg</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;q0 here&#34;</span><span class=p>,</span> <span class=n>q</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=n>k</span> <span class=o>=</span> <span class=n>H</span><span class=p>(</span><span class=n>msg</span> <span class=o>+</span> <span class=n>long_to_bytes</span><span class=p>(</span><span class=n>x</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>pow</span><span class=p>(</span><span class=mi>3</span><span class=p>,</span><span class=n>k</span><span class=p>,</span><span class=n>preal</span><span class=p>))</span> <span class=o>%</span> <span class=n>q</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>e</span> <span class=o>=</span> <span class=n>H</span><span class=p>(</span><span class=n>long_to_bytes</span><span class=p>(</span><span class=n>r</span><span class=p>)</span> <span class=o>+</span> <span class=n>msg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=p>(</span><span class=n>k</span> <span class=o>-</span> <span class=n>x</span> <span class=o>*</span> <span class=n>e</span><span class=p>)</span> <span class=o>%</span> <span class=n>q</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>(</span><span class=n>s</span><span class=p>,</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>row</span> <span class=ow>in</span> <span class=n>res</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>row</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>==</span> <span class=mi>1</span> <span class=ow>or</span> <span class=n>row</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>k0</span> <span class=o>=</span> <span class=n>row</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>k0</span><span class=o>.</span><span class=n>numerator</span><span class=p>()</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>k0</span> <span class=o>=</span> <span class=o>-</span><span class=n>k0</span>
</span></span><span class=line><span class=cl>        <span class=n>k0</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>k0</span><span class=o>.</span><span class=n>numerator</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=n>k0</span> <span class=o>=</span> <span class=n>k0</span><span class=o>*</span><span class=p>(</span><span class=mi>2</span><span class=o>^</span><span class=mi>256</span><span class=o>+</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>secret</span> <span class=o>=</span> <span class=p>(</span><span class=n>k0</span> <span class=o>-</span> <span class=n>s_temp</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span> <span class=o>%</span> <span class=n>q</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>secret</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>secret</span><span class=o>*</span><span class=n>inverse</span><span class=p>(</span><span class=n>e_temp</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span><span class=n>q</span><span class=p>[</span><span class=mi>0</span><span class=p>]))</span> <span class=o>%</span> <span class=n>q</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>temp</span> <span class=o>=</span> <span class=n>sign</span><span class=p>(</span><span class=n>secret</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>s_temp</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=n>temp</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>e_temp</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=n>temp</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;right hand&#34;</span><span class=o>.</span><span class=n>hex</span><span class=p>())</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=n>sign</span><span class=p>(</span><span class=n>secret</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;right hand&#34;</span><span class=p>))</span>
</span></span></code></pre></div><p>Flag is: <strong>HTB{full_s1z3_n0nc3_l4cks_ful1_s1z3_3ntr0py}</strong></p><h2 id=converging-visions>Converging Visions</h2><ul><li><p><strong>Description:</strong> As you hold the relic in your hands, it prompts you to input a coordinate. The ancient scriptures you uncovered near the pharaoh&rsquo;s tomb reveal that the artifact is capable of transmitting the locations of vessels. The initial coordinate must be within proximity of the vessels, and an algorithm will then calculate their precise locations for transmission. However, you soon discover that the coordinates transmitted are not correct, and are encrypted using advanced alien techniques to prevent unauthorized access. It becomes clear that the true coordinates are hidden, serving only to authenticate those with knowledge of the artifact&rsquo;s secrets. Can you decipher this alien encryption and uncover the genuine coordinates to locate the vessels and destroy them?</p></li><li><p><strong>Category:</strong> Cryptography</p></li><li><p><strong>Difficulty:</strong> Hard</p></li></ul><p>We are given a Python script.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>secret</span> <span class=kn>import</span> <span class=n>FLAG</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>sage.all_cmdline</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>PRNG</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>mul1</span><span class=p>,</span> <span class=n>mul2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>mod</span> <span class=o>=</span> <span class=n>p</span> <span class=o>*</span> <span class=mi>6089788258325039501929073418355467714844813056959443481824909430411674443639248386564763122373451773381582660411059922334086996696436657009055324008041039</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>exp</span> <span class=o>=</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>mul1</span> <span class=o>=</span> <span class=n>mul1</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>mul2</span> <span class=o>=</span> <span class=n>mul2</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>inc</span> <span class=o>=</span> <span class=nb>int</span><span class=o>.</span><span class=n>from_bytes</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;Coordinates lost in space&#39;</span><span class=p>,</span> <span class=s1>&#39;big&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>seed</span> <span class=o>=</span> <span class=n>randint</span><span class=p>(</span><span class=mi>2</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>mod</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>rotate</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>seed</span> <span class=o>=</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>mul1</span> <span class=o>*</span> <span class=nb>pow</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>seed</span><span class=p>,</span> <span class=mi>3</span><span class=p>)</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>mul2</span> <span class=o>*</span> <span class=bp>self</span><span class=o>.</span><span class=n>seed</span> <span class=o>+</span>
</span></span><span class=line><span class=cl>                     <span class=bp>self</span><span class=o>.</span><span class=n>inc</span><span class=p>)</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>mod</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>seed</span><span class=p>,</span> <span class=nb>pow</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>seed</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>exp</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>mod</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Relic</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>p</span><span class=p>,</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>E</span> <span class=o>=</span> <span class=n>EllipticCurve</span><span class=p>(</span><span class=n>GF</span><span class=p>(</span><span class=n>p</span><span class=p>),</span> <span class=p>[</span><span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>P</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>EP</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>p</span> <span class=o>=</span> <span class=n>p</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>prng</span> <span class=o>=</span> <span class=n>PRNG</span><span class=p>(</span><span class=n>p</span><span class=p>,</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>setupPoints</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>x</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>x</span> <span class=o>&gt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>p</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s1>&#39;Coordinate greater than curve modulus&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>P</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>E</span><span class=o>.</span><span class=n>lift_x</span><span class=p>(</span><span class=n>Integer</span><span class=p>(</span><span class=n>x</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>EP</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>P</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=s1>&#39;Point not on curve&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>(</span><span class=s1>&#39;Point confirmed on curve&#39;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>P</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>P</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>nextPoints</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>seed</span><span class=p>,</span> <span class=n>enc_seed</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>prng</span><span class=o>.</span><span class=n>rotate</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>P</span> <span class=o>*=</span> <span class=n>seed</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>EP</span> <span class=o>*=</span> <span class=n>enc_seed</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>(</span><span class=s1>&#39;New Points&#39;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>EP</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>EP</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>P</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>P</span><span class=p>[</span><span class=mi>1</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>menu</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Options:</span><span class=se>\n</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;1. Setup Point&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;2. Receive new point&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;3. Find true point&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>option</span> <span class=o>=</span> <span class=nb>input</span><span class=p>(</span><span class=s1>&#39;&gt; &#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>option</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>artifact</span> <span class=o>=</span> <span class=n>Relic</span><span class=p>(</span><span class=n>p</span><span class=p>,</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>setup</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>option</span> <span class=o>=</span> <span class=n>menu</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>option</span> <span class=o>==</span> <span class=s1>&#39;1&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Enter x coordinate&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>x</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>input</span><span class=p>(</span><span class=s1>&#39;x: &#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=n>response</span> <span class=o>=</span> <span class=n>artifact</span><span class=o>.</span><span class=n>setupPoints</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>response</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>==</span> <span class=s1>&#39;Point confirmed on curve&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>setup</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=n>response</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>option</span> <span class=o>==</span> <span class=s1>&#39;2&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>setup</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>response</span> <span class=o>=</span> <span class=n>artifact</span><span class=o>.</span><span class=n>nextPoints</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Response&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>((</span><span class=n>response</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span> <span class=n>response</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span> <span class=n>response</span><span class=p>[</span><span class=mi>2</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Configure origin point first&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>option</span> <span class=o>==</span> <span class=s1>&#39;3&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>setup</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Input x,y&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>Px</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>input</span><span class=p>(</span><span class=s1>&#39;x: &#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                    <span class=n>Py</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>input</span><span class=p>(</span><span class=s1>&#39;y: &#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                    <span class=n>response</span> <span class=o>=</span> <span class=n>artifact</span><span class=o>.</span><span class=n>nextPoints</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>response</span><span class=p>[</span><span class=mi>3</span><span class=p>]</span> <span class=o>==</span> <span class=n>Px</span> <span class=ow>and</span> <span class=n>response</span><span class=p>[</span><span class=mi>4</span><span class=p>]</span> <span class=o>==</span> <span class=n>Py</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=nb>print</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                            <span class=s1>&#39;You have confirmed the location. It</span><span class=se>\&#39;</span><span class=s1>s dangerous however to go alone. Take this: &#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                            <span class=n>FLAG</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;The vessels will never be found...&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>exit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Configure origin point first&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Invalid option, sutting down&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>exit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>response</span> <span class=o>=</span> <span class=sa>f</span><span class=s1>&#39;An error occured: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s1>&#39;</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>response</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>exit</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>p</span><span class=o>.</span><span class=n>bit_length</span><span class=p>()</span> <span class=o>==</span> <span class=mi>256</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></div><p>So, for any \(i\neq j\), $$a \equiv \dfrac{Y_i^2-Y_j^2-X_i^3+X_j^3}{X_i-X_j} \pmod{p}$$</p><p>Which means for any distinct \(i,j,k,l\), $$(Y_i^2-Y_j^2-X_i^3+X_j^3)(X_k-X_l)-(Y_k^2-Y_l^2-X_k^3+X_l^3)(X_i-X_j) \equiv 0 \pmod{p}$$</p><p>So by playing with several $i,j,k,l$ and take GCD stuff, we obtain $$p=91720173941422125335466921700213991383508377854521057423162397714341988797837$$.</p><p>Also, we can find \(a\) and \(b\) by consider the equation system $$Y_i^2-X_i^3=aX_i+b \text{ for }i=1,2$$.</p><p>We get that $$a=57186237363769678415558546920636910250184560730836527033755705455333464722170$$, $$b=47572366756434660406002599832623767973471965640106574131304711893212728437629$$</p><p>Now the important thing is to note that: \(|E/\mathbb{F}_p|=p\), thus we can easily solve the discrete log problem on \(E\) using <code>Smart's attack</code>. In addition, we only need to consider the RNG in modulo \(p\).</p><p>Back to the challenge, we see the challenge is almost equivalent: Given \(P,x^2\times P\), find \((ax^3+bx+C)\times P\). To do this, we need to find \(x\) .Fortunately, because the DL problem is easy, we can easily find \(x\). The attack is described as follow:</p><ol><li><p>Let \(P\) be any point on the curve.</p></li><li><p>Let the current round be \(i\), we can use <code>Option 2</code> to get the value \(r[i]^2\times P\). At this time, \(state.P=r[i]\times P\).</p></li><li><p>Use Smart&rsquo;s attack to restore \(r[i]^2\), then restore \(r[i]\) with probability \(\dfrac{1}{2}\).</p></li><li><p>Calculate \(predict=ar[i]^3+br[i]+C \pmod{p}\).</p></li><li><p>Use <code>Option 1</code> and enter the coordinate of \(P[1]\). This will set \(state.P=P\) and the next point will be equal to \(r[i+1]\times P\).</p></li><li><p>Enter <code>Option 3</code> and enter the coordinates of \(predict\times P[1]\).</p></li></ol><p>The attack has \(\dfrac{1}{2}\) probability of success because we have \(\dfrac{1}{2}\) probability of getting the right \(r[i]\). So by doing this multiple times, we get the flag.</p><p>Flag is: <strong>HTB{0Racl3_AS_a_f3A7Ur3_0n_W3aK_CURV3_aND_PRN9??_7H3_s3cur17Y_0F_0uR_CRyP70Sys73M_w1LL_c0LLAp53!!!}</strong></p><h2 id=blokechain>Blokechain</h2><ul><li><p><strong>Given file:</strong> <a href=https://github.com/sudo-rainman/ctf_script/tree/main/htb_cyberapocalypse2023/crypto_blokechain target=_blank rel=noopener>Get it here!</a></p></li><li><p><strong>Description:</strong> After successfully locating the vessels and obtaining the relic, you and your team begin to strategize on how to destroy them. However, upon further examination, it becomes clear that the vessels are connected with advanced alien technology that simulates a blockchain. In order to destroy the pods, you realize that you need to possess the wealth of the entire galaxy. The fate of the Earth rests on your ability to find a solution to this seemingly impossible problem. Can you devise a plan to destroy the vessels and save humanity from their destructive power? Note: This challenge is not intended for beginners. It is an insane level of difficulty. Good luck and have fun!</p></li><li><p><strong>Category:</strong> Cryptography</p></li><li><p><strong>Difficulty:</strong> Insane</p></li></ul><p>This challenge has an unintended solution where you can just resubmit the hash, lmao. R.I.P overthinkers.</p><p>Here is the script:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span> 
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span> <span class=o>=</span> <span class=n>remote</span><span class=p>(</span><span class=s2>&#34;178.62.9.10&#34;</span><span class=p>,</span><span class=mi>30794</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>total</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=k>while</span> <span class=n>total</span> <span class=o>&lt;</span> <span class=mi>100000000</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;vessels</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s2>&#34;1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;vessels</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s2>&#34;2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>60</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s2>&#34;1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>ans</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>temp</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=sa>b</span><span class=s2>&#34;Balance&#34;</span> <span class=ow>in</span> <span class=n>temp</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>temp</span> <span class=o>=</span> <span class=n>temp</span><span class=p>[</span><span class=nb>len</span><span class=p>(</span><span class=s2>&#34;expected hash &#34;</span><span class=p>):</span><span class=nb>len</span><span class=p>(</span><span class=s2>&#34;expected hash &#34;</span><span class=p>)</span><span class=o>+</span><span class=mi>25</span><span class=p>]</span><span class=o>.</span><span class=n>decode</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>ans</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>temp</span><span class=p>,</span><span class=mi>16</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;vessels</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s2>&#34;2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>ans1</span> <span class=o>=</span> <span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>*</span><span class=p>(</span><span class=mi>60</span><span class=o>-</span><span class=nb>len</span><span class=p>(</span><span class=n>ans</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>ans1</span> <span class=o>=</span> <span class=n>ans1</span> <span class=o>+</span> <span class=n>ans</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>60</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;: &#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=nb>str</span><span class=p>(</span><span class=n>ans1</span><span class=p>[</span><span class=n>i</span><span class=p>]))</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>temp</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=sa>b</span><span class=s2>&#34;Balance&#34;</span> <span class=ow>in</span> <span class=n>temp</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>total</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>temp</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>decode</span><span class=p>()[</span><span class=nb>len</span><span class=p>(</span><span class=s2>&#34;Balance: &#34;</span><span class=p>):])</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=n>total</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>break</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>recvuntil</span><span class=p>(</span><span class=s2>&#34;vessels</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>r</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s2>&#34;3&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>r</span><span class=o>.</span><span class=n>recvline</span><span class=p>())</span>
</span></span></code></pre></div><p>Flag is: <strong>HTB{7h3_vess3ls_4r3_des7r0yed_g0od_j0b}</strong></p><h2 id=original-post>Original Post</h2><ul><li><p><a href=https://fazect.github.io/htb2023/ target=_blank rel=noopener>From FazeCT</a></p></li><li><p><a href=https://junvalentine.github.io/posts/htb-wu-2023/#colliding-heritage target=_blank rel=noopener>From Onirique</a></p></li><li><p><a href=https://haopham23.github.io/dashaus165blog/ target=_blank rel=noopener>From dasHaus</a></p></li></ul></div><div class=article-tags><a class="badge badge-light" href=/tag/ctf/>ctf</a>
<a class="badge badge-light" href=/tag/writeup/>writeup</a>
<a class="badge badge-light" href=/tag/crypto/>crypto</a>
<a class="badge badge-light" href=/tag/htb-2023/>htb-2023</a></div><div class=share-box><ul class=share><li><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fblog.bkisc.com%2Fblog%2Fbkisc%2Fhtb2023-crypto%2F&text=Cyber+Apocalypse+2023%3A+The+Cursed+Mission+-+Cryptography" target=_blank rel=noopener class=share-btn-twitter aria-label=twitter><i class="fab fa-twitter"></i></a></li><li><a href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fblog.bkisc.com%2Fblog%2Fbkisc%2Fhtb2023-crypto%2F&t=Cyber+Apocalypse+2023%3A+The+Cursed+Mission+-+Cryptography" target=_blank rel=noopener class=share-btn-facebook aria-label=facebook><i class="fab fa-facebook"></i></a></li><li><a href="mailto:?subject=Cyber%20Apocalypse%202023%3A%20The%20Cursed%20Mission%20-%20Cryptography&body=https%3A%2F%2Fblog.bkisc.com%2Fblog%2Fbkisc%2Fhtb2023-crypto%2F" target=_blank rel=noopener class=share-btn-email aria-label=envelope><i class="fas fa-envelope"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Fblog.bkisc.com%2Fblog%2Fbkisc%2Fhtb2023-crypto%2F&title=Cyber+Apocalypse+2023%3A+The+Cursed+Mission+-+Cryptography" target=_blank rel=noopener class=share-btn-linkedin aria-label=linkedin-in><i class="fab fa-linkedin-in"></i></a></li><li><a href="whatsapp://send?text=Cyber+Apocalypse+2023%3A+The+Cursed+Mission+-+Cryptography%20https%3A%2F%2Fblog.bkisc.com%2Fblog%2Fbkisc%2Fhtb2023-crypto%2F" target=_blank rel=noopener class=share-btn-whatsapp aria-label=whatsapp><i class="fab fa-whatsapp"></i></a></li><li><a href="https://service.weibo.com/share/share.php?url=https%3A%2F%2Fblog.bkisc.com%2Fblog%2Fbkisc%2Fhtb2023-crypto%2F&title=Cyber+Apocalypse+2023%3A+The+Cursed+Mission+-+Cryptography" target=_blank rel=noopener class=share-btn-weibo aria-label=weibo><i class="fab fa-weibo"></i></a></li></ul></div><div class="media author-card content-widget-hr"><a href=/author/onirique/><img class="avatar mr-3 avatar-circle" src=/author/onirique/avatar_hu8c6b91a6c2eae83f406a44092e6d577f_254439_270x270_fill_lanczos_center_3.png alt=Onirique></a><div class=media-body><h5 class=card-title><a href=/author/onirique/>Onirique</a></h5><h6 class=card-subtitle>Cryptographer</h6><p class=card-text>Enjoying everyday life</p><ul class=network-icon aria-hidden=true><li><a href=mailto:minh.lehong2003@hcmut.edu.vn><i class="fas fa-envelope"></i></a></li><li><a href=https://github.com/junvalentine target=_blank rel=noopener><i class="fab fa-github"></i></a></li></ul></div></div><div class="media author-card content-widget-hr"><a href=/author/fazect/><img class="avatar mr-3 avatar-circle" src=/author/fazect/avatar_hud20978e2ce79cef4f33eb5572feeafc8_109792_270x270_fill_lanczos_center_3.png alt=FazeCT></a><div class=media-body><h5 class=card-title><a href=/author/fazect/>FazeCT</a></h5><h6 class=card-subtitle>Reverser</h6><p class=card-text>Skill issue is one of my inner traits.</p><ul class=network-icon aria-hidden=true><li><a href=mailto:ctffazect@gmail.com><i class="fas fa-envelope"></i></a></li><li><a href=https://github.com/FazeCT target=_blank rel=noopener><i class="fab fa-github"></i></a></li><li><a href=https://fazect.github.io/ target=_blank rel=noopener><i class="fas fa-globe"></i></a></li></ul></div></div><div class="media author-card content-widget-hr"><a href=/author/dashaus165/><img class="avatar mr-3 avatar-circle" src=/author/dashaus165/avatar_huc4c6d401f2bdf4fe8f8da315f9330c44_1540457_270x270_fill_q75_lanczos_center.jpg alt=dasHaus165></a><div class=media-body><h5 class=card-title><a href=/author/dashaus165/>dasHaus165</a></h5><h6 class=card-subtitle>Cryptographer</h6><p class=card-text>I am a cryptographer who started playing CTFs in November 2022. I am currently focusing on learning applied mathematics, cryptography and machine learning.</p><ul class=network-icon aria-hidden=true><li><a href=mailto:hao.pham1652003@gmail.com><i class="fas fa-envelope"></i></a></li><li><a href=https://www.facebook.com/pham.hao.58511 target=_blank rel=noopener><i class="fab fa-facebook"></i></a></li><li><a href=https://github.com/HaoPham23 target=_blank rel=noopener><i class="fab fa-github"></i></a></li></ul></div></div><div class="media author-card content-widget-hr"><a href=/author/tn/><img class="avatar mr-3 avatar-circle" src=/author/tn/avatar_hu9e08bb3fdc266ffb55c66da3b99079ba_136822_270x270_fill_lanczos_center_3.png alt=TN></a><div class=media-body><h5 class=card-title><a href=/author/tn/>TN</a></h5><h6 class=card-subtitle>Cryptographer</h6><p class=card-text>TN stands for op</p><ul class=network-icon aria-hidden=true><li><a href=mailto:long.hoang.sugoii@hcmut.edu.vn><i class="fas fa-envelope"></i></a></li><li><a href=https://github.com/sudo-rainman target=_blank rel=noopener><i class="fab fa-github"></i></a></li></ul></div></div><div class="media author-card content-widget-hr"><a href=/author/nothing/><img class="avatar mr-3 avatar-circle" src=/author/nothing/avatar_hu89aa8d8afa2dee9ceedbb84e788ca559_16636_270x270_fill_lanczos_center_3.png alt=Nothing></a><div class=media-body><h5 class=card-title><a href=/author/nothing/>Nothing</a></h5><h6 class=card-subtitle>Cryptographer</h6><p class=card-text>A cryptographer from BKISC.</p><ul class=network-icon aria-hidden=true></ul></div></div></div></article></div><div class=page-footer><div class=container><footer class=site-footer><p class="powered-by copyright-license-text">© 2025 BK Information Security Club</p><p class=powered-by>Published with <a href="https://wowchemy.com/?utm_campaign=poweredby" target=_blank rel=noopener>Wowchemy</a> — the free, <a href=https://github.com/wowchemy/wowchemy-hugo-themes target=_blank rel=noopener>open source</a> website builder that empowers creators.</p></footer></div></div><script src=/js/vendor-bundle.min.fab8b449b814cc9f95b22fcf2e45f05b.js></script>
<script src=https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.min.js integrity crossorigin=anonymous></script>
<script id=search-hit-fuse-template type=text/x-template>
    <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
    </div>
  </script><script src=https://cdn.jsdelivr.net/gh/krisk/Fuse@v3.2.1/dist/fuse.min.js integrity="sha512-o38bmzBGX+hD3JHWUFCDA09btWaqrNmoJ3RXLlrysA7PP01Kgs4UlE4MhelE1v5dJR3+cxlR4qQlotsW7jKsnw==" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/gh/julmot/mark.js@8.11.1/dist/jquery.mark.min.js integrity="sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg==" crossorigin=anonymous></script>
<script id=page-data type=application/json>{"use_headroom":true}</script><script src=/js/wowchemy-headroom.db4755770454eb63685f8de785c0a172.js type=module></script>
<script src=/en/js/wowchemy.min.0c1be879804fa6ae06a8f4c131cdbf54.js></script>
<script src=/js/wowchemy-map.a26e9d2f7238ba5b868384f1c5bc6477.js type=module></script></body></html>